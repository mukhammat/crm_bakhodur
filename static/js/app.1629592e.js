(function(){"use strict";var e={6520:function(e,t,a){var l=a(5130),n=a(6768),r=a(144),o=a(1387),s=(a(4114),a(4232)),u={__name:"AppHeader",setup(e){const t=(0,o.rd)(),a=(0,o.lq)(),l=[{name:"Главная",path:"/",icon:"mdi-home"},{name:"Задачи",path:"/tasks",icon:"mdi-clipboard-check"},{name:"Работники",path:"/users",icon:"mdi-information"}],r=e=>{a.path!==e&&t.push(e).catch(e=>{console.error("Navigation error:",e)})},u=()=>{r("/")},i=e=>(0,n.EW)(()=>"/"===e?"/"===a.path:a.path.startsWith(e)).value,d=()=>{console.log("Выход из системы"),t.push("/login").catch(e=>{console.error("Logout navigation error:",e)})};return(e,t)=>{const a=(0,n.g2)("v-icon"),o=(0,n.g2)("v-toolbar-title"),c=(0,n.g2)("v-spacer"),v=(0,n.g2)("v-btn"),m=(0,n.g2)("v-list-item-title"),k=(0,n.g2)("v-list-item"),f=(0,n.g2)("v-divider"),p=(0,n.g2)("v-list"),g=(0,n.g2)("v-menu"),b=(0,n.g2)("v-app-bar");return(0,n.uX)(),(0,n.Wv)(b,{app:"",color:"primary",dark:"",elevation:"2"},{default:(0,n.k6)(()=>[(0,n.bF)(o,{class:"cursor-pointer",onClick:u},{default:(0,n.k6)(()=>[(0,n.bF)(a,{left:""},{default:(0,n.k6)(()=>[...t[2]||(t[2]=[(0,n.eW)("mdi-rocket",-1)])]),_:1}),t[3]||(t[3]=(0,n.eW)(" CRM Bakhodur ",-1))]),_:1}),(0,n.bF)(c),((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(l,e=>(0,n.bF)(v,{key:e.name,onClick:t=>r(e.path),color:i(e.path)?"white":"",variant:i(e.path)?"flat":"text",class:"mx-1"},{default:(0,n.k6)(()=>[e.icon?((0,n.uX)(),(0,n.Wv)(a,{key:0,start:""},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.icon),1)]),_:2},1024)):(0,n.Q3)("",!0),(0,n.eW)(" "+(0,s.v_)(e.name),1)]),_:2},1032,["onClick","color","variant"])),64)),(0,n.bF)(g,null,{activator:(0,n.k6)(({props:e})=>[(0,n.bF)(v,(0,n.v6)({icon:""},e,{color:i("/profile")?"white":""}),{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[...t[4]||(t[4]=[(0,n.eW)("mdi-account-circle",-1)])]),_:1})]),_:1},16,["color"])]),default:(0,n.k6)(()=>[(0,n.bF)(p,null,{default:(0,n.k6)(()=>[(0,n.bF)(k,{onClick:t[0]||(t[0]=e=>r("/profile"))},{prepend:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[...t[5]||(t[5]=[(0,n.eW)("mdi-account",-1)])]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)(m,null,{default:(0,n.k6)(()=>[...t[6]||(t[6]=[(0,n.eW)("Профиль",-1)])]),_:1})]),_:1}),(0,n.bF)(k,{onClick:t[1]||(t[1]=e=>r("/settings"))},{prepend:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.eW)("mdi-cog",-1)])]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)(m,null,{default:(0,n.k6)(()=>[...t[8]||(t[8]=[(0,n.eW)("Настройки",-1)])]),_:1})]),_:1}),(0,n.bF)(f),(0,n.bF)(k,{onClick:d},{prepend:(0,n.k6)(()=>[(0,n.bF)(a,{color:"error"},{default:(0,n.k6)(()=>[...t[9]||(t[9]=[(0,n.eW)("mdi-logout",-1)])]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)(m,null,{default:(0,n.k6)(()=>[...t[10]||(t[10]=[(0,n.eW)("Выход",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},i=a(1241);const d=(0,i.A)(u,[["__scopeId","data-v-bd5ec064"]]);var c=d,v={__name:"App",setup(e){const t=(0,o.lq)();return(e,a)=>{const l=(0,n.g2)("router-view"),o=(0,n.g2)("v-main"),s=(0,n.g2)("v-app");return(0,n.uX)(),(0,n.Wv)(s,null,{default:(0,n.k6)(()=>[(0,r.R1)(t).meta.hideHeader?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(c,{key:0})),(0,n.bF)(o,null,{default:(0,n.k6)(()=>[(0,n.bF)(l)]),_:1})]),_:1})}}};const m=v;var k=m,f=a(1114);a(4603),a(7566),a(8721);class p{static async request(e,t){return(new p).request(e,t)}async request(e,t){const a="Content-Type",l={};let n=t.body;if(t.bodyType)switch(t.bodyType){case"HTML":l[a]="text/html";break;case"JS":l[a]="application/javascript";break;case"JSON":l[a]="application/json",n=JSON.stringify(t.body);break;case"Text":l[a]="application/plain";break;case"XML":l[a]="application/xml";break;default:l[a]=t.bodyType;break}else"object"===typeof t.body&&(l["Content-Type"]="application/json",n=JSON.stringify(t.body));try{const a=await fetch(e,{method:t.method,headers:{...l,...t.headers},body:n});if(!a.ok)throw new Error(a?.message||`Ошибка ${a.status}`);return a}catch(r){throw console.log(r?.message),r}}}var g=a(2261);const b="http://localhost:3000",h=(0,g.nY)("auth",{state:()=>{const e=localStorage.getItem("token")||null;return console.log("🔍 Auth Store initialized, token:",e?"EXISTS":"NULL"),{user:null,token:e,tokenExpiryTimer:null}},getters:{role:e=>e.user?.role||null,isAuthenticated:e=>!!e.token},actions:{setTokenExpiry(e){this.tokenExpiryTimer&&clearTimeout(this.tokenExpiryTimer);const t=1e3*e;this.tokenExpiryTimer=setTimeout(()=>{console.warn("Token expired, logging out..."),this.logout(),"/login"!==window.location.pathname&&(window.location.href="/login?reason=session_expired")},t);const a=Date.now()+t;localStorage.setItem("tokenExpiry",a.toString())},checkTokenExpiry(){const e=localStorage.getItem("tokenExpiry");if(!e)return!1;const t=Date.now(),a=parseInt(e,10);if(t>=a)return this.logout(),!0;const l=Math.floor((a-t)/1e3);return this.setTokenExpiry(l),!1},parseExpiresIn(e){if("number"===typeof e)return e;const t=e.match(/^(\d+)([smhd])$/);if(!t)return 3600;const a=parseInt(t[1],10),l=t[2],n={s:1,m:60,h:3600,d:86400};return a*(n[l]||3600)},async login({email:e,password:t}){console.log("🔐 Login attempt for:",e);try{const a=await fetch(`${b}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!a.ok){const e=await a.json();throw new Error(e.message||"Неверный логин или пароль")}const{data:l}=await a.json();console.log("✅ Login response:",l),this.token=l.token,localStorage.setItem("token",this.token),console.log("💾 Token saved to localStorage");const n=l.expiresIn?this.parseExpiresIn(l.expiresIn):3600;console.log("⏰ Token expires in:",n,"seconds"),this.setTokenExpiry(n),await this.fetchMe(),console.log("👤 User loaded:",this.user)}catch(a){throw console.error("❌ Login error:",a),this.logout(),a}},async register(e){try{const t=await fetch(`${b}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.message||"Ошибка при регистрации")}const a=await t.json();return await this.login({email:e.email,password:e.password}),a.data?.userId}catch(t){throw this.logout(),t}},async fetchMe(){if(this.token)try{const e=await fetch(`${b}/api/users/me`,{headers:{Authorization:`Bearer ${this.token}`}});if(!e.ok){if(401===e.status)throw this.logout(),new Error("Сессия истекла");throw new Error("Не удалось загрузить профиль")}const{data:t}=await e.json();this.user=t}catch(e){throw e.message.includes("Сессия истекла")&&this.logout(),e}},logout(){this.tokenExpiryTimer&&(clearTimeout(this.tokenExpiryTimer),this.tokenExpiryTimer=null),this.user=null,this.token=null,localStorage.removeItem("token"),localStorage.removeItem("tokenExpiry")},async init(){if(this.token){const t=this.checkTokenExpiry();if(!t)try{await this.fetchMe()}catch(e){console.warn("Failed to restore user session:",e.message)}}}}});class y{constructor(){(0,f.A)(this,"SERVER","http://localhost:3000")}get headers(){return this.auth=h(),{Authorization:this.auth.token?`Bearer ${this.auth.token}`:""}}async add(e){return p.request(`${this.SERVER}/api/tasks`,{method:"POST",headers:this.headers,body:e})}async removeAssignment(e){return p.request(`${this.SERVER}/api/tasks/unassign-task-from-worker/${e}`,{method:"DELETE",headers:this.headers})}async edit(e,t){return p.request(`${this.SERVER}/api/tasks/${e}`,{method:"PUT",headers:this.headers,body:t})}async delete(e){return p.request(`${this.SERVER}/api/tasks/${e}`,{method:"DELETE",headers:this.headers})}async assignUser(e){return p.request(`${this.SERVER}/api/tasks/assign-task-worker`,{method:"POST",headers:this.headers,body:e})}async getAll(e={}){const t=new URLSearchParams(e).toString();return p.request(`${this.SERVER}/api/tasks${t?`?${t}`:""}`,{headers:this.headers})}async getAssignmentLength(e){return p.request(`${this.SERVER}/api/tasks/assignment-length/${e}`,{headers:this.headers})}}const _=new y,F={key:0,class:"text-red"};var w={__name:"DashboardPage",setup(e){const t=(0,r.KR)({inProgress:0,pending:0,points:0}),a=(0,r.KR)(null),l=[{title:"Имя",key:"name"},{title:"Выполнено задач",key:"tasksCompleted"},{title:"Баллы",key:"points"}],o=[{name:"Иван",tasksCompleted:50,points:1200},{name:"Анна",tasksCompleted:45,points:1100},{name:"Олег",tasksCompleted:30,points:700}];async function u(e){const t=await _.getAll({status:e});if(!t.ok){const e=await t.text();throw new Error(`Ошибка ${t.status}: ${e}`)}return t.json()}return(0,n.sV)(async()=>{try{const e=await u("in_progress");t.value.inProgress=e.data.tasks.length;const a=await u("pending");t.value.pending=a.data.tasks.length;const l=[...e.data.tasks,...a.data.tasks];t.value.points=l.reduce((e,t)=>e+(t.points??0),0)}catch(e){a.value=e.message,console.error("Ошибка загрузки задач:",e)}}),(e,r)=>{const u=(0,n.g2)("v-card-title"),i=(0,n.g2)("v-card-text"),d=(0,n.g2)("v-card"),c=(0,n.g2)("v-col"),v=(0,n.g2)("v-row"),m=(0,n.g2)("v-data-table"),k=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(k,null,{default:(0,n.k6)(()=>[(0,n.bF)(v,null,{default:(0,n.k6)(()=>[(0,n.bF)(c,{cols:"12",md:"3"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(u,null,{default:(0,n.k6)(()=>[...r[0]||(r[0]=[(0,n.eW)("В процессе",-1)])]),_:1}),(0,n.bF)(i,{class:"text-h4"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(t.value.inProgress),1)]),_:1})]),_:1})]),_:1}),(0,n.bF)(c,{cols:"12",md:"3"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(u,null,{default:(0,n.k6)(()=>[...r[1]||(r[1]=[(0,n.eW)("Ожидают",-1)])]),_:1}),(0,n.bF)(i,{class:"text-h4"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(t.value.pending),1)]),_:1})]),_:1})]),_:1}),(0,n.bF)(c,{cols:"12",md:"3"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(u,null,{default:(0,n.k6)(()=>[...r[2]||(r[2]=[(0,n.eW)("Сумма баллов",-1)])]),_:1}),(0,n.bF)(i,{class:"text-h4"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(t.value.points),1)]),_:1})]),_:1})]),_:1})]),_:1}),(0,n.bF)(v,null,{default:(0,n.k6)(()=>[(0,n.bF)(c,{cols:"12",md:"6"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(u,null,{default:(0,n.k6)(()=>[...r[3]||(r[3]=[(0,n.eW)("Задачи по статусу",-1)])]),_:1}),(0,n.bF)(i,null,{default:(0,n.k6)(()=>[...r[4]||(r[4]=[(0,n.Lk)("div",{class:"text-center"},"[Диаграмма]",-1)])]),_:1})]),_:1})]),_:1}),(0,n.bF)(c,{cols:"12",md:"6"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(u,null,{default:(0,n.k6)(()=>[...r[5]||(r[5]=[(0,n.eW)("Топ сотрудников",-1)])]),_:1}),(0,n.bF)(m,{headers:l,items:o})]),_:1})]),_:1})]),_:1}),a.value?((0,n.uX)(),(0,n.CE)("div",F,"Ошибка: "+(0,s.v_)(a.value),1)):(0,n.Q3)("",!0)]),_:1})}}};const W=w;var x=W,E={__name:"TaskForm",props:{getTasks:Function},setup(e){const t=(0,r.KR)({title:"",description:"",priority:0}),a=e,l=a.getTasks,o=(0,r.KR)(!1),s=(0,r.KR)(!1);async function u(){if(t.value.title&&t.value.description)try{s.value=!0;const e=await _.add({priority:Number(t.value.priority),title:t.value.title,description:t.value.description});e.ok&&(i(),await l())}finally{s.value=!1}}function i(){o.value=!1,t.value={title:"",description:"",priority:0}}return(e,a)=>{const d=(0,n.g2)("v-btn"),c=(0,n.g2)("v-card-title"),v=(0,n.g2)("v-row"),m=(0,n.g2)("v-text-field"),k=(0,n.g2)("v-card-text"),f=(0,n.g2)("v-spacer"),p=(0,n.g2)("v-card-actions"),g=(0,n.g2)("v-card"),b=(0,n.g2)("v-dialog"),h=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(h,null,{default:(0,n.k6)(()=>[(0,n.bF)(v,{justify:"center"},{default:(0,n.k6)(()=>[(0,n.bF)(c,null,{default:(0,n.k6)(()=>[(0,n.bF)(d,{color:"primary",onClick:(0,r.R1)(l),class:"mr-2"},{default:(0,n.k6)(()=>[...a[5]||(a[5]=[(0,n.eW)("Обновить",-1)])]),_:1},8,["onClick"]),(0,n.bF)(d,{color:"success",onClick:a[0]||(a[0]=e=>o.value=!0)},{default:(0,n.k6)(()=>[...a[6]||(a[6]=[(0,n.eW)("Добавить задачу",-1)])]),_:1})]),_:1})]),_:1}),(0,n.bF)(b,{modelValue:o.value,"onUpdate:modelValue":a[4]||(a[4]=e=>o.value=e),"max-width":"500px"},{default:(0,n.k6)(()=>[(0,n.bF)(g,null,{default:(0,n.k6)(()=>[(0,n.bF)(c,null,{default:(0,n.k6)(()=>[...a[7]||(a[7]=[(0,n.eW)("Добавить задачу",-1)])]),_:1}),(0,n.bF)(k,null,{default:(0,n.k6)(()=>[(0,n.bF)(m,{modelValue:t.value.title,"onUpdate:modelValue":a[1]||(a[1]=e=>t.value.title=e),label:"Название",required:""},null,8,["modelValue"]),(0,n.bF)(m,{modelValue:t.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value.description=e),label:"Описание",required:""},null,8,["modelValue"]),(0,n.bF)(m,{modelValue:t.value.priority,"onUpdate:modelValue":a[3]||(a[3]=e=>t.value.priority=e),label:"Приоритет",required:""},null,8,["modelValue"])]),_:1}),(0,n.bF)(p,null,{default:(0,n.k6)(()=>[(0,n.bF)(f),(0,n.bF)(d,{text:"",onClick:i},{default:(0,n.k6)(()=>[...a[8]||(a[8]=[(0,n.eW)("Отмена",-1)])]),_:1}),(0,n.bF)(d,{color:"success",onClick:u,loading:s.value},{default:(0,n.k6)(()=>[...a[9]||(a[9]=[(0,n.eW)(" Сохранить ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};const V=E;var R=V;a(8111),a(2489),a(1701);function T(){const e=h(),t=(0,n.EW)(()=>e.role),a=(0,n.EW)(()=>"admin"===t.value),l=(0,n.EW)(()=>"manager"===t.value),r=(0,n.EW)(()=>"worker"===t.value),o=e=>t.value===e,s=e=>e.includes(t.value),u=(0,n.EW)(()=>s(["admin","manager"])),i=(0,n.EW)(()=>s(["admin","manager"])),d=(0,n.EW)(()=>s(["admin","manager"])),c=(0,n.EW)(()=>"worker"===t.value);return{userRole:t,isAdmin:a,isManager:l,isWorker:r,hasRole:o,hasAnyRole:s,canManageUsers:u,canCreateTasks:i,canViewAllTasks:d,canOnlyViewOwnTasks:c}}class C{constructor(){(0,f.A)(this,"SERVER","http://localhost:3000")}get headers(){return this.auth=h(),{Authorization:this.auth.token?`Bearer ${this.auth.token}`:""}}async me(){return p.request(`${this.SERVER}/api/user/me`,{method:"GET",headers:this.headers})}async getAll(){return p.request(`${this.SERVER}/api/users`,{method:"GET",headers:this.headers})}async delete(e){return p.request(`${this.SERVER}/api/users/${e}`,{method:"DELETE",headers:this.headers})}async generateKey(e){return p.request(`${this.SERVER}/api/users/register-key/${e}`,{method:"GET",headers:this.headers})}}const K=new C,A={class:"text-truncate",style:{"max-width":"200px"}},L={class:"d-flex align-center"},S={key:1,class:"text-grey text-caption align-self-center ml-2"};var X={__name:"TaskList",props:{tasks:Array,getTasks:Function},setup(e){const{isAdmin:t}=T(),a=h(),o=(0,n.EW)(()=>e=>t.value||e.createdBy?.id===a.user?.id),u=(0,n.EW)(()=>e=>t.value||e.createdBy?.id===a.user?.id),i=[{label:"Ожидает",value:"pending"},{label:"В процессе",value:"in_progress"},{label:"Завершено",value:"completed"}],d=[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"4",value:4},{label:"5",value:5}],c=e,v=(0,r.lW)(c,"tasks"),m=c.getTasks,k=(0,r.KR)([]),f=(0,r.KR)(!1),p=(0,r.KR)([]),g=(0,r.KR)(!1),b=(0,r.KR)(!1),y=(0,r.KR)(!1),F=(0,r.KR)(null),w=(0,r.KR)(null),W=(0,r.KR)(!1),x=(0,r.KR)(!1),E=(0,r.KR)(!1),V=(0,r.KR)(""),R=(0,r.KR)(""),C=e=>{V.value=e,x.value=!0},X=e=>{R.value=e,E.value=!0};async function $(){try{W.value=!0;const e=await K.getAll(),t=await e.json();k.value=t.data.users}catch(e){console.error("Error fetching users:",e),X("Ошибка загрузки пользователей")}finally{W.value=!1}}(0,n.sV)($);const j=[{title:"Название",key:"title"},{title:"Приоритет",key:"priority"},{title:"Статус",key:"status"},{title:"Создатель",key:"createdBy.name"},{title:"Исполнители",key:"assignments.worker"}];function U(e,{item:t}){q(t)}function q(e){F.value={...e,workerIds:e.assignments?.map(e=>e.userId)||[]},g.value=!0}function I(){g.value=!1,F.value=null}function O(e){w.value=e,b.value=!0,g.value=!1}function Q(e){F.value.workerIds=F.value.workerIds.filter(t=>t!==e)}async function P(e,t){for(const a of t){const e=await _.removeAssignment(a.id);if(!e.ok)throw new Error(`Ошибка при удалении назначения ${a.id}`)}}async function z(){if(F.value.title&&F.value.description&&F.value.status)try{y.value=!0;const e=await _.edit(F.value.id,{title:F.value.title,description:F.value.description,status:F.value.status,priority:F.value.priority});if(!e.ok)throw new Error("Ошибка при обновлении задачи");F.value.assignments?.length>0&&await P(F.value.id,F.value.assignments);for(const t of F.value.workerIds){const e=await _.assignUser({taskId:F.value.id,userId:t});if(!e.ok)throw new Error("Ошибка назначения пользователя")}await m(),I(),C("Задача успешно обновлена")}catch(e){console.error("Error saving task:",e),X(e.message||"Ошибка при сохранении задачи")}finally{y.value=!1}else X("Пожалуйста, заполните все обязательные поля")}async function M(){if(w.value)try{p.value.push(w.value.id);const e=await _.delete(w.value.id);if(!e.ok)throw new Error("Ошибка при удалении задачи");await m(),C("Задача успешно удалена")}catch(e){console.error("Error deleting task:",e),X(e.message||"Ошибка при удалении задачи")}finally{p.value=p.value.filter(e=>e!==w.value.id),b.value=!1,w.value=null}}function B(e){switch(e){case"admin":return"red";case"manager":return"blue";case"worker":return"green";default:return"grey"}}function N(e){switch(e){case"completed":return"green";case"in_progress":return"blue";case"pending":return"orange";default:return"grey"}}function D(e){switch(e){case"completed":return"Завершено";case"in_progress":return"В процессе";case"pending":return"Ожидает";default:return e}}return(e,c)=>{const m=(0,n.g2)("v-badge"),h=(0,n.g2)("v-btn"),_=(0,n.g2)("v-list-item-title"),T=(0,n.g2)("v-chip"),C=(0,n.g2)("v-list-item"),K=(0,n.g2)("v-list"),X=(0,n.g2)("v-menu"),$=(0,n.g2)("v-data-table"),q=(0,n.g2)("v-card"),P=(0,n.g2)("v-col"),G=(0,n.g2)("v-row"),H=(0,n.g2)("v-card-title"),J=(0,n.g2)("v-text-field"),Y=(0,n.g2)("v-textarea"),Z=(0,n.g2)("v-select"),ee=(0,n.g2)("v-icon"),te=(0,n.g2)("v-avatar"),ae=(0,n.g2)("v-alert"),le=(0,n.g2)("v-container"),ne=(0,n.g2)("v-card-text"),re=(0,n.g2)("v-spacer"),oe=(0,n.g2)("v-card-actions"),se=(0,n.g2)("v-dialog"),ue=(0,n.g2)("v-snackbar");return(0,n.uX)(),(0,n.Wv)(le,null,{default:(0,n.k6)(()=>[(0,n.bF)(G,{justify:"center"},{default:(0,n.k6)(()=>[(0,n.bF)(P,{cols:"12",md:"10"},{default:(0,n.k6)(()=>[(0,n.bF)(q,null,{default:(0,n.k6)(()=>[(0,n.bF)($,{headers:j,items:v.value,"item-key":"id",class:"elevation-1",loading:f.value,"onClick:row":U,hover:""},{"item.title":(0,n.k6)(({item:e})=>[(0,n.eW)((0,s.v_)(e.title),1)]),"item.description":(0,n.k6)(({item:e})=>[(0,n.Lk)("div",A,(0,s.v_)(e.description),1)]),"item.assignments.worker":(0,n.k6)(({item:e})=>[e.assignments&&e.assignments.length>0?((0,n.uX)(),(0,n.Wv)(X,{key:0,onClick:c[0]||(c[0]=(0,l.D$)(()=>{},["stop"]))},{activator:(0,n.k6)(({props:t})=>[(0,n.bF)(h,(0,n.v6)(t,{color:"green",size:"small",variant:"tonal"}),{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.assignments[0]?.user?.name||"Без имени")+" ",1),e.assignments.length>1?((0,n.uX)(),(0,n.Wv)(m,{key:0,content:e.assignments.length,color:"primary",inline:""},null,8,["content"])):(0,n.Q3)("",!0)]),_:2},1040)]),default:(0,n.k6)(()=>[(0,n.bF)(K,{density:"compact"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.assignments,e=>((0,n.uX)(),(0,n.Wv)(C,{key:e.id},{append:(0,n.k6)(()=>[(0,n.bF)(T,{size:"x-small",color:B(e.user?.role)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.user?.role),1)]),_:2},1032,["color"])]),default:(0,n.k6)(()=>[(0,n.bF)(_,{class:"text-body-2"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.user?.name||"Без имени"),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):((0,n.uX)(),(0,n.Wv)(T,{key:1,color:"grey",variant:"outlined",size:"small"},{default:(0,n.k6)(()=>[...c[12]||(c[12]=[(0,n.eW)(" Не назначен ",-1)])]),_:1}))]),"item.status":(0,n.k6)(({item:e})=>[(0,n.bF)(T,{color:N(e?.status),variant:"flat",size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(D(e?.status)),1)]),_:2},1032,["color"])]),"item.createdBy.name":(0,n.k6)(({item:e})=>[(0,n.Lk)("div",L,[(0,n.Lk)("span",null,(0,s.v_)(e.createdBy?.name||"Неизвестно"),1),e.createdBy?.id===(0,r.R1)(a).user?.id?((0,n.uX)(),(0,n.Wv)(T,{key:0,color:"primary",size:"x-small",class:"ml-2"},{default:(0,n.k6)(()=>[...c[13]||(c[13]=[(0,n.eW)(" Ваша ",-1)])]),_:1})):(0,n.Q3)("",!0)])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),(0,n.bF)(se,{modelValue:g.value,"onUpdate:modelValue":c[7]||(c[7]=e=>g.value=e),"max-width":"700px"},{default:(0,n.k6)(()=>[F.value?((0,n.uX)(),(0,n.Wv)(q,{key:0},{default:(0,n.k6)(()=>[(0,n.bF)(H,null,{default:(0,n.k6)(()=>[c[15]||(c[15]=(0,n.Lk)("span",{class:"text-h6"},"Редактировать задачу",-1)),F.value?.createdBy?.id!==(0,r.R1)(a).user?.id||(0,r.R1)(t)?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(T,{key:0,color:"primary",size:"small",class:"ml-3"},{default:(0,n.k6)(()=>[...c[14]||(c[14]=[(0,n.eW)(" Ваша задача ",-1)])]),_:1}))]),_:1}),(0,n.bF)(ne,null,{default:(0,n.k6)(()=>[(0,n.bF)(le,null,{default:(0,n.k6)(()=>[(0,n.bF)(G,null,{default:(0,n.k6)(()=>[(0,n.bF)(P,{cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(J,{modelValue:F.value.title,"onUpdate:modelValue":c[1]||(c[1]=e=>F.value.title=e),label:"Название задачи",required:"",rules:[e=>!!e||"Название обязательно"],variant:"outlined",disabled:!o.value(F.value)},null,8,["modelValue","rules","disabled"])]),_:1}),(0,n.bF)(P,{cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(Y,{modelValue:F.value.description,"onUpdate:modelValue":c[2]||(c[2]=e=>F.value.description=e),label:"Описание задачи",required:"",rules:[e=>!!e||"Описание обязательно"],rows:"3",variant:"outlined",disabled:!o.value(F.value)},null,8,["modelValue","rules","disabled"])]),_:1}),(0,n.bF)(P,{cols:"12",md:"6"},{default:(0,n.k6)(()=>[(0,n.bF)(Z,{modelValue:F.value.priority,"onUpdate:modelValue":c[3]||(c[3]=e=>F.value.priority=e),items:d,"item-title":"label","item-value":"value",label:"Приоритет",variant:"outlined",disabled:!o.value(F.value)},null,8,["modelValue","disabled"])]),_:1}),(0,n.bF)(P,{cols:"12",md:"6"},{default:(0,n.k6)(()=>[(0,n.bF)(Z,{modelValue:F.value.status,"onUpdate:modelValue":c[4]||(c[4]=e=>F.value.status=e),items:i,"item-title":"label","item-value":"value",label:"Статус задачи",variant:"outlined",disabled:!o.value(F.value)},null,8,["modelValue","disabled"])]),_:1}),(0,n.bF)(P,{cols:"12",md:"6"},{default:(0,n.k6)(()=>[(0,n.bF)(T,{color:N(F.value.status),class:"mt-4"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(D(F.value.status)),1)]),_:1},8,["color"])]),_:1}),(0,n.bF)(P,{cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(Z,{modelValue:F.value.workerIds,"onUpdate:modelValue":c[5]||(c[5]=e=>F.value.workerIds=e),items:k.value,"item-title":"name","item-value":"id",label:"Назначить пользователей",multiple:"",chips:"","closable-chips":"",loading:W.value,variant:"outlined",disabled:!o.value(F.value)},{selection:(0,n.k6)(({item:e,index:t})=>[t<3?((0,n.uX)(),(0,n.Wv)(T,{key:0,size:"small",closable:"",color:B(e.raw.role),variant:"tonal","onClick:close":t=>Q(e.raw.id)},{default:(0,n.k6)(()=>[(0,n.bF)(ee,{start:"",size:"16"},{default:(0,n.k6)(()=>[...c[16]||(c[16]=[(0,n.eW)("mdi-account",-1)])]),_:1}),(0,n.eW)(" "+(0,s.v_)(e.title),1)]),_:2},1032,["color","onClick:close"])):(0,n.Q3)("",!0),3===t?((0,n.uX)(),(0,n.CE)("span",S," (+"+(0,s.v_)(F.value.workerIds.length-3)+" других) ",1)):(0,n.Q3)("",!0)]),item:(0,n.k6)(({props:e,item:t})=>[(0,n.bF)(C,(0,n.v6)(e,{title:t.title}),{prepend:(0,n.k6)(()=>[(0,n.bF)(te,{size:"32",color:B(t.raw.role)},{default:(0,n.k6)(()=>[(0,n.bF)(ee,null,{default:(0,n.k6)(()=>[...c[17]||(c[17]=[(0,n.eW)("mdi-account",-1)])]),_:1})]),_:1},8,["color"])]),append:(0,n.k6)(()=>[(0,n.bF)(T,{size:"x-small",color:B(t.raw.role)},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(t.raw.role),1)]),_:2},1032,["color"]),F.value.workerIds.includes(t.value)?((0,n.uX)(),(0,n.Wv)(ee,{key:0,color:"success",class:"ml-2"},{default:(0,n.k6)(()=>[...c[18]||(c[18]=[(0,n.eW)(" mdi-check ",-1)])]),_:1})):(0,n.Q3)("",!0)]),_:2},1040,["title"])]),"no-data":(0,n.k6)(()=>[(0,n.bF)(C,null,{default:(0,n.k6)(()=>[(0,n.bF)(_,null,{default:(0,n.k6)(()=>[...c[19]||(c[19]=[(0,n.eW)("Пользователи не найдены",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading","disabled"])]),_:1}),0===F.value.workerIds.length?((0,n.uX)(),(0,n.Wv)(P,{key:0,cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(ae,{type:"warning",variant:"tonal",density:"compact"},{default:(0,n.k6)(()=>[...c[20]||(c[20]=[(0,n.eW)(" Задача не назначена ни одному пользователю ",-1)])]),_:1})]),_:1})):(0,n.Q3)("",!0),o.value(F.value)?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(P,{key:1,cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(ae,{type:"info",variant:"tonal",density:"compact"},{default:(0,n.k6)(()=>[...c[21]||(c[21]=[(0,n.eW)(" У вас нет прав на редактирование этой задачи ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),(0,n.bF)(oe,null,{default:(0,n.k6)(()=>[u.value(F.value)?((0,n.uX)(),(0,n.Wv)(h,{key:0,color:"error",variant:"text",onClick:c[6]||(c[6]=e=>O(F.value)),loading:p.value.includes(F.value.id)},{default:(0,n.k6)(()=>[...c[22]||(c[22]=[(0,n.eW)(" Удалить ",-1)])]),_:1},8,["loading"])):(0,n.Q3)("",!0),(0,n.bF)(re),(0,n.bF)(h,{variant:"text",onClick:I},{default:(0,n.k6)(()=>[...c[23]||(c[23]=[(0,n.eW)(" Закрыть ",-1)])]),_:1}),o.value(F.value)?((0,n.uX)(),(0,n.Wv)(h,{key:1,color:"success",onClick:z,loading:y.value,disabled:!F.value.title||!F.value.description},{default:(0,n.k6)(()=>[...c[24]||(c[24]=[(0,n.eW)(" Сохранить изменения ",-1)])]),_:1},8,["loading","disabled"])):(0,n.Q3)("",!0)]),_:1})]),_:1})):(0,n.Q3)("",!0)]),_:1},8,["modelValue"]),(0,n.bF)(se,{modelValue:b.value,"onUpdate:modelValue":c[9]||(c[9]=e=>b.value=e),"max-width":"400px"},{default:(0,n.k6)(()=>[(0,n.bF)(q,null,{default:(0,n.k6)(()=>[(0,n.bF)(H,{class:"text-h6"},{default:(0,n.k6)(()=>[...c[25]||(c[25]=[(0,n.eW)(" Подтвердите удаление ",-1)])]),_:1}),(0,n.bF)(ne,null,{default:(0,n.k6)(()=>[(0,n.eW)(' Вы уверены, что хотите удалить задачу "'+(0,s.v_)(w.value?.title)+'"? Это действие нельзя отменить. ',1)]),_:1}),(0,n.bF)(oe,null,{default:(0,n.k6)(()=>[(0,n.bF)(re),(0,n.bF)(h,{variant:"text",onClick:c[8]||(c[8]=e=>b.value=!1)},{default:(0,n.k6)(()=>[...c[26]||(c[26]=[(0,n.eW)(" Отмена ",-1)])]),_:1}),(0,n.bF)(h,{color:"error",onClick:M,loading:p.value.includes(w.value?.id)},{default:(0,n.k6)(()=>[...c[27]||(c[27]=[(0,n.eW)(" Удалить ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,n.bF)(ue,{modelValue:x.value,"onUpdate:modelValue":c[10]||(c[10]=e=>x.value=e),color:"success",timeout:"3000"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(V.value),1)]),_:1},8,["modelValue"]),(0,n.bF)(ue,{modelValue:E.value,"onUpdate:modelValue":c[11]||(c[11]=e=>E.value=e),color:"error",timeout:"5000"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(R.value),1)]),_:1},8,["modelValue"])]),_:1})}}};const $=X;var j=$,U={__name:"TaskManager",setup(e){const t=(0,r.KR)([]),a=(0,r.KR)(null),l=[{label:"Ожидает",value:"pending"},{label:"В процессе",value:"in_progress"},{label:"Завершено",value:"completed"},{label:"Все",value:null}];async function o(){try{const e={};a.value&&(e.status=a.value);const l=await _.getAll(e),n=await l.json();t.value=n.data.tasks,console.log(n.data.tasks)}catch(e){console.error("Error fetching tasks:",e)}}return(0,n.sV)(o),(0,n.wB)(a,()=>{o()}),(e,r)=>{const s=(0,n.g2)("v-select"),u=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.bF)(u,{md:"5"},{default:(0,n.k6)(()=>[(0,n.bF)(s,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=e=>a.value=e),items:l,"item-title":"label","item-value":"value",label:"Фильтр по статусу",class:"mb-1",chips:"","closable-chips":""},null,8,["modelValue"])]),_:1}),(0,n.bF)(R,{getTasks:o}),(0,n.bF)(j,{getTasks:o,tasks:t.value},null,8,["tasks"])],64)}}};const q=U;var I=q;a(8237);const O={class:"text-center"},Q={class:"text-h3 font-weight-bold"},P={class:"text-subtitle-1 mt-2"},z={class:"d-flex align-center justify-space-between"},M={class:"text-h4 font-weight-bold"};var B={__name:"UserList",props:{users:Array,getUsers:Function},setup(e){const t=e,a=(0,r.lW)(t,"users"),o=t.getUsers,u=(0,r.KR)([]),i=(0,r.KR)(!1),d=(0,r.KR)(null),c=(0,r.KR)(null),v=(0,r.KR)(!1),m=[{title:"Имя",key:"name"},{title:"Почта",key:"email"},{title:"Роль",key:"role"},{title:"Активный",key:"isActive"},{title:"Действия",key:"actions",sortable:!1}],k=(0,n.EW)(()=>c.value?c.value.reduce((e,t)=>e+parseInt(t.count),0):0);async function f(e,{item:t}){d.value=t,i.value=!0,await p(t.id)}async function p(e){try{v.value=!0;const t=await _.getAssignmentLength(e),a=await t.json();a.rows&&a.rows.length>0?c.value=a.rows:c.value=null}catch(t){console.error("Error loading user stats:",t),c.value=null}finally{v.value=!1}}function g(){i.value=!1,d.value=null,c.value=null}async function b(e){try{u.value.push(e);const t=await K.delete(e);t.ok&&await o()}catch(t){console.error("Error deleting user:",t)}finally{u.value=u.value.filter(t=>t!==e)}}function h(e){switch(e){case"admin":return"red";case"manager":return"blue";case"worker":return"green";default:return"grey"}}function y(e){switch(e){case"completed":return"green";case"in_progress":return"blue";case"pending":return"orange";default:return"grey"}}function F(e){switch(e){case"completed":return"Завершено";case"in_progress":return"В процессе";case"pending":return"Ожидает";default:return e}}return(e,t)=>{const r=(0,n.g2)("v-chip"),o=(0,n.g2)("v-btn"),p=(0,n.g2)("v-data-table"),_=(0,n.g2)("v-card"),w=(0,n.g2)("v-col"),W=(0,n.g2)("v-row"),x=(0,n.g2)("v-card-title"),E=(0,n.g2)("v-card-subtitle"),V=(0,n.g2)("v-progress-circular"),R=(0,n.g2)("v-container"),T=(0,n.g2)("v-divider"),C=(0,n.g2)("v-alert"),K=(0,n.g2)("v-card-text"),A=(0,n.g2)("v-spacer"),L=(0,n.g2)("v-card-actions"),S=(0,n.g2)("v-dialog");return(0,n.uX)(),(0,n.Wv)(R,null,{default:(0,n.k6)(()=>[(0,n.bF)(W,{justify:"center"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{cols:"14",md:"10"},{default:(0,n.k6)(()=>[(0,n.bF)(_,null,{default:(0,n.k6)(()=>[(0,n.bF)(p,{headers:m,items:a.value,"item-key":"id",class:"elevation-1","onClick:row":f,hover:""},{"item.name":(0,n.k6)(({item:e})=>[(0,n.eW)((0,s.v_)(e.name),1)]),"item.email":(0,n.k6)(({item:e})=>[(0,n.eW)((0,s.v_)(e.email),1)]),"item.role":(0,n.k6)(({item:e})=>[(0,n.bF)(r,{color:h(e.role),size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.role),1)]),_:2},1032,["color"])]),"item.isActive":(0,n.k6)(({item:e})=>[(0,n.bF)(r,{color:e.isActive?"green":"red",size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(e.isActive?"Активен":"Неактивен"),1)]),_:2},1032,["color"])]),"item.actions":(0,n.k6)(({item:e})=>[(0,n.Lk)("div",{onClick:t[0]||(t[0]=(0,l.D$)(()=>{},["stop"]))},[(0,n.bF)(o,{color:"red",size:"small",variant:"outlined",onClick:t=>b(e.id),loading:u.value.includes(e.id)},{default:(0,n.k6)(()=>[...t[2]||(t[2]=[(0,n.eW)(" Удалить ",-1)])]),_:1},8,["onClick","loading"])])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),(0,n.bF)(S,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),"max-width":"600px"},{default:(0,n.k6)(()=>[d.value?((0,n.uX)(),(0,n.Wv)(_,{key:0},{default:(0,n.k6)(()=>[(0,n.bF)(x,null,{default:(0,n.k6)(()=>[...t[3]||(t[3]=[(0,n.Lk)("span",{class:"text-h6"},"Статистика задач",-1)])]),_:1}),(0,n.bF)(E,{class:"mt-2"},{default:(0,n.k6)(()=>[(0,n.eW)(" Пользователь: "+(0,s.v_)(d.value.name),1)]),_:1}),(0,n.bF)(K,null,{default:(0,n.k6)(()=>[v.value?((0,n.uX)(),(0,n.Wv)(R,{key:0},{default:(0,n.k6)(()=>[(0,n.bF)(W,{justify:"center"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{cols:"12",class:"text-center"},{default:(0,n.k6)(()=>[(0,n.bF)(V,{indeterminate:"",color:"primary"}),t[4]||(t[4]=(0,n.Lk)("p",{class:"mt-4"},"Загрузка статистики...",-1))]),_:1})]),_:1})]),_:1})):c.value?((0,n.uX)(),(0,n.Wv)(R,{key:1},{default:(0,n.k6)(()=>[(0,n.bF)(W,null,{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c.value,e=>((0,n.uX)(),(0,n.Wv)(w,{cols:"12",md:"4",key:e.status},{default:(0,n.k6)(()=>[(0,n.bF)(_,{color:y(e.status),variant:"tonal",class:"pa-4"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",O,[(0,n.Lk)("div",Q,(0,s.v_)(e.count),1),(0,n.Lk)("div",P,(0,s.v_)(F(e.status)),1)])]),_:2},1032,["color"])]),_:2},1024))),128)),(0,n.bF)(w,{cols:"12",class:"mt-4"},{default:(0,n.k6)(()=>[(0,n.bF)(T)]),_:1}),(0,n.bF)(w,{cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(_,{variant:"outlined",class:"pa-4"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",z,[t[5]||(t[5]=(0,n.Lk)("span",{class:"text-h6"},"Всего задач:",-1)),(0,n.Lk)("span",M,(0,s.v_)(k.value),1)])]),_:1})]),_:1})]),_:1})]),_:1})):((0,n.uX)(),(0,n.Wv)(R,{key:2},{default:(0,n.k6)(()=>[(0,n.bF)(C,{type:"info",variant:"tonal"},{default:(0,n.k6)(()=>[...t[6]||(t[6]=[(0,n.eW)(" У пользователя пока нет назначенных задач ",-1)])]),_:1})]),_:1}))]),_:1}),(0,n.bF)(L,null,{default:(0,n.k6)(()=>[(0,n.bF)(A),(0,n.bF)(o,{variant:"text",onClick:g},{default:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.eW)(" Закрыть ",-1)])]),_:1})]),_:1})]),_:1})):(0,n.Q3)("",!0)]),_:1},8,["modelValue"])]),_:1})}}};const N=(0,i.A)(B,[["__scopeId","data-v-5c77d70f"]]);var D=N;const G={class:"d-flex align-center"},H={class:"mb-3"},J={class:"d-flex gap-2"};var Y={__name:"GenerateKey",setup(e){const t=(0,r.KR)(""),a=(0,r.KR)(""),l=(0,r.KR)(!1),o=(0,r.KR)(!1),u=(0,r.KR)(""),i=[{title:"Менеджер",value:"manager"},{title:"Работник",value:"worker"}],d=async()=>{try{if(!t.value)return;const e=await K.generateKey(t.value),l=await e.json();if(!e.ok)throw new Error(l.message||"Ошибка при генерации ключа");a.value=l.data.key}catch(e){u.value=e.message||"Ошибка при генерации ключа",o.value=!0}},c=async()=>{try{await navigator.clipboard.writeText(a.value),l.value=!0}catch(e){u.value="Не удалось скопировать ключ",o.value=!0}},v=async()=>{const e={title:"Ключ доступа",text:`Ключ доступа (${k(t.value)}): ${a.value}`,url:window.location.href};try{navigator.share?await navigator.share(e):(await navigator.clipboard.writeText(e.text),l.value=!0)}catch(n){u.value="Не удалось поделиться ключом",o.value=!0}},m=e=>{const t={manager:"orange",worker:"blue"};return t[e]||"grey"},k=e=>{const t=i.find(t=>t.value===e);return t?t.title:""};return(e,r)=>{const f=(0,n.g2)("v-card-title"),p=(0,n.g2)("v-select"),g=(0,n.g2)("v-btn"),b=(0,n.g2)("v-chip"),h=(0,n.g2)("v-divider"),y=(0,n.g2)("v-text-field"),_=(0,n.g2)("v-card-text"),F=(0,n.g2)("v-card"),w=(0,n.g2)("v-snackbar"),W=(0,n.g2)("v-col"),x=(0,n.g2)("v-row"),E=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(E,null,{default:(0,n.k6)(()=>[(0,n.bF)(x,{justify:"center"},{default:(0,n.k6)(()=>[e.isAdmin?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(W,{key:0,cols:"10",md:"5"},{default:(0,n.k6)(()=>[(0,n.bF)(F,null,{default:(0,n.k6)(()=>[(0,n.bF)(f,null,{default:(0,n.k6)(()=>[...r[5]||(r[5]=[(0,n.eW)("Сгенерировать ключ",-1)])]),_:1}),(0,n.bF)(_,null,{default:(0,n.k6)(()=>[(0,n.bF)(p,{modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=e=>t.value=e),items:i,"item-title":"title","item-value":"value",label:"Выберите роль",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),(0,n.bF)(g,{color:"primary",onClick:d,disabled:!t.value,block:"",class:"mb-4"},{default:(0,n.k6)(()=>[...r[6]||(r[6]=[(0,n.eW)(" Сгенерировать ключ ",-1)])]),_:1},8,["disabled"]),a.value?((0,n.uX)(),(0,n.Wv)(F,{key:0,variant:"outlined",class:"mb-4"},{default:(0,n.k6)(()=>[(0,n.bF)(_,null,{default:(0,n.k6)(()=>[(0,n.Lk)("div",G,[(0,n.bF)(b,{color:m(t.value),class:"me-2"},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(k(t.value)),1)]),_:1},8,["color"]),r[7]||(r[7]=(0,n.Lk)("span",{class:"text-caption text-medium-emphasis"}," Роль ",-1))]),(0,n.bF)(h,{class:"my-3"}),(0,n.Lk)("div",H,[r[8]||(r[8]=(0,n.Lk)("div",{class:"text-subtitle-2 mb-2"},"Сгенерированный ключ:",-1)),(0,n.bF)(y,{"model-value":a.value,readonly:"",variant:"outlined",density:"compact",class:"key-field"},{"append-inner":(0,n.k6)(()=>[(0,n.bF)(g,{icon:"mdi-content-copy",size:"small",variant:"text",onClick:c})]),_:1},8,["model-value"])]),(0,n.Lk)("div",J,[(0,n.bF)(g,{color:"success",variant:"outlined","prepend-icon":"mdi-content-copy",onClick:c},{default:(0,n.k6)(()=>[...r[9]||(r[9]=[(0,n.eW)(" Копировать ",-1)])]),_:1}),(0,n.bF)(g,{color:"primary",variant:"outlined","prepend-icon":"mdi-share",onClick:v},{default:(0,n.k6)(()=>[...r[10]||(r[10]=[(0,n.eW)(" Поделиться ",-1)])]),_:1})])]),_:1})]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(w,{modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=e=>l.value=e),color:"success",timeout:"2000"},{actions:(0,n.k6)(()=>[(0,n.bF)(g,{variant:"text",onClick:r[1]||(r[1]=e=>l.value=!1)},{default:(0,n.k6)(()=>[...r[11]||(r[11]=[(0,n.eW)(" Закрыть ",-1)])]),_:1})]),default:(0,n.k6)(()=>[r[12]||(r[12]=(0,n.eW)(" Ключ скопирован в буфер обмена! ",-1))]),_:1},8,["modelValue"]),(0,n.bF)(w,{modelValue:o.value,"onUpdate:modelValue":r[4]||(r[4]=e=>o.value=e),color:"error",timeout:"3000"},{actions:(0,n.k6)(()=>[(0,n.bF)(g,{variant:"text",onClick:r[3]||(r[3]=e=>o.value=!1)},{default:(0,n.k6)(()=>[...r[13]||(r[13]=[(0,n.eW)(" Закрыть ",-1)])]),_:1})]),default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(u.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1})}}};const Z=(0,i.A)(Y,[["__scopeId","data-v-ca72003c"]]);var ee=Z,te={__name:"UserManager",setup(e){const{isAdmin:t}=T(),a=(0,r.KR)([]);async function l(){try{const e=await K.getAll(),t=await e.json();console.log(t.data.users),a.value=t.data.users}catch(e){console.error("Error fetching tasks:",e)}}return(0,n.sV)(l),(e,o)=>((0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.bF)(D,{getUsers:l,users:a.value},null,8,["users"]),(0,r.R1)(t)?((0,n.uX)(),(0,n.Wv)(ee,{key:0})):(0,n.Q3)("",!0)],64))}};const ae=te;var le=ae;const ne={class:"text-center"};var re={__name:"LoginPage",setup(e){const t=h(),a=(0,o.rd)(),u=(0,r.KR)(""),i=(0,r.KR)(""),d=(0,r.KR)(""),c=(0,r.KR)(!1),v=async()=>{d.value="",c.value=!0;try{await t.login({email:u.value,password:i.value}),a.push("/tasks")}catch(e){d.value=e.message}finally{c.value=!1}};return(e,t)=>{const a=(0,n.g2)("v-card-title"),r=(0,n.g2)("v-text-field"),o=(0,n.g2)("v-alert"),m=(0,n.g2)("v-btn"),k=(0,n.g2)("v-form"),f=(0,n.g2)("v-divider"),p=(0,n.g2)("v-card-text"),g=(0,n.g2)("v-card"),b=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(b,{class:"d-flex justify-center align-center fill-height"},{default:(0,n.k6)(()=>[(0,n.bF)(g,{class:"pa-6",width:"400"},{default:(0,n.k6)(()=>[(0,n.bF)(a,{class:"text-h6"},{default:(0,n.k6)(()=>[...t[3]||(t[3]=[(0,n.eW)("Login",-1)])]),_:1}),(0,n.bF)(p,null,{default:(0,n.k6)(()=>[(0,n.bF)(k,{onSubmit:(0,l.D$)(v,["prevent"]),ref:"form"},{default:(0,n.k6)(()=>[(0,n.bF)(r,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),label:"Email",type:"email","prepend-icon":"mdi-email",required:""},null,8,["modelValue"]),(0,n.bF)(r,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),label:"Password",type:"password","prepend-icon":"mdi-lock",required:""},null,8,["modelValue"]),d.value?((0,n.uX)(),(0,n.Wv)(o,{key:0,type:"error",class:"mb-4",dense:""},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(d.value),1)]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(m,{type:"submit",color:"primary",block:"",loading:c.value},{default:(0,n.k6)(()=>[...t[4]||(t[4]=[(0,n.eW)(" Войти ",-1)])]),_:1},8,["loading"])]),_:1},512),(0,n.bF)(f,{class:"my-4"}),(0,n.Lk)("div",ne,[t[6]||(t[6]=(0,n.Lk)("span",{class:"text-body-2"},"Нет аккаунта?",-1)),(0,n.bF)(m,{variant:"text",color:"primary",onClick:t[2]||(t[2]=t=>e.$router.push("/register")),class:"ml-2"},{default:(0,n.k6)(()=>[...t[5]||(t[5]=[(0,n.eW)(" Зарегистрироваться ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})}}};const oe=re;var se=oe;const ue={class:"text-center"};var ie={__name:"RegisterPage",setup(e){const t=h(),a=(0,o.rd)(),u=(0,r.KR)(""),i=(0,r.KR)(""),d=(0,r.KR)(""),c=(0,r.KR)(""),v=(0,r.KR)(""),m=(0,r.KR)(!1),k=async()=>{v.value="",m.value=!0;try{await t.register({name:u.value,email:i.value,password:d.value,key:c.value}),a.push("/tasks")}catch(e){v.value=e.message}finally{m.value=!1}};return(e,t)=>{const a=(0,n.g2)("v-card-title"),r=(0,n.g2)("v-text-field"),o=(0,n.g2)("v-alert"),f=(0,n.g2)("v-btn"),p=(0,n.g2)("v-form"),g=(0,n.g2)("v-divider"),b=(0,n.g2)("v-card-text"),h=(0,n.g2)("v-card"),y=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(y,{class:"d-flex justify-center align-center fill-height"},{default:(0,n.k6)(()=>[(0,n.bF)(h,{class:"pa-6",width:"400"},{default:(0,n.k6)(()=>[(0,n.bF)(a,{class:"text-h6"},{default:(0,n.k6)(()=>[...t[5]||(t[5]=[(0,n.eW)("Регистрация",-1)])]),_:1}),(0,n.bF)(b,null,{default:(0,n.k6)(()=>[(0,n.bF)(p,{onSubmit:(0,l.D$)(k,["prevent"]),ref:"form"},{default:(0,n.k6)(()=>[(0,n.bF)(r,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),label:"Имя","prepend-icon":"mdi-account",required:""},null,8,["modelValue"]),(0,n.bF)(r,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),label:"Email",type:"email","prepend-icon":"mdi-email",required:""},null,8,["modelValue"]),(0,n.bF)(r,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),label:"Пароль",type:"password","prepend-icon":"mdi-lock",required:""},null,8,["modelValue"]),(0,n.bF)(r,{modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=e=>c.value=e),label:"Ключ регистрации","prepend-icon":"mdi-key",required:""},null,8,["modelValue"]),v.value?((0,n.uX)(),(0,n.Wv)(o,{key:0,type:"error",class:"mb-4",dense:""},{default:(0,n.k6)(()=>[(0,n.eW)((0,s.v_)(v.value),1)]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(f,{type:"submit",color:"primary",block:"",loading:m.value},{default:(0,n.k6)(()=>[...t[6]||(t[6]=[(0,n.eW)(" Зарегистрироваться ",-1)])]),_:1},8,["loading"])]),_:1},512),(0,n.bF)(g,{class:"my-4"}),(0,n.Lk)("div",ue,[t[8]||(t[8]=(0,n.Lk)("span",{class:"text-body-2"},"Уже есть аккаунт?",-1)),(0,n.bF)(f,{variant:"text",color:"primary",onClick:t[4]||(t[4]=t=>e.$router.push("/login")),class:"ml-2"},{default:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.eW)(" Войти ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})}}};const de=ie;var ce=de;const ve=[{path:"/tasks",name:"tasks",component:I,meta:{requiresAuth:!0,roles:["admin","manager","worker"]}},{path:"/users",name:"users",component:le,meta:{requiresAuth:!0,roles:["admin","manager"]}},{path:"/",name:"dashboard",component:x,meta:{requiresAuth:!0,roles:["admin","manager"]}},{path:"/login",name:"login",component:se,meta:{hideHeader:!0,requiresGuest:!0}},{path:"/register",name:"register",component:ce,meta:{hideHeader:!0,requiresGuest:!0}},{path:"/forbidden",name:"forbidden",component:()=>a.e(156).then(a.bind(a,1156)),meta:{hideHeader:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}],me=(0,o.aE)({history:(0,o.LA)(),routes:ve});me.beforeEach(async(e,t,a)=>{const l=h();if(e.meta.requiresGuest)return l.token&&l.user?a("/"):a();if(l.token&&!l.user)try{await l.fetchMe()}catch(r){console.warn("Failed to fetch user:",r.message)}const n=l.token&&l.user;if(e.meta.requiresAuth&&!n)return a("/login");if(e.meta.roles&&n){const t=l.role,n=e.meta.roles;if(!n.includes(t))return console.warn(`Access denied. User role: ${t}, Required: ${n}`),a("/forbidden")}a()});var ke=me,fe=(a(5524),a(5753)),pe=a(2801),ge=a(3425);const be=(0,fe.$N)({components:pe,directives:ge}),he=(0,l.Ef)(k),ye=(0,g.Ey)();he.use(ye);const _e=h();_e.init().finally(()=>{he.use(ke),he.use(be),he.mount("#app")})}},t={};function a(l){var n=t[l];if(void 0!==n)return n.exports;var r=t[l]={exports:{}};return e[l].call(r.exports,r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,l,n,r){if(!l){var o=1/0;for(d=0;d<e.length;d++){l=e[d][0],n=e[d][1],r=e[d][2];for(var s=!0,u=0;u<l.length;u++)(!1&r||o>=r)&&Object.keys(a.O).every(function(e){return a.O[e](l[u])})?l.splice(u--,1):(s=!1,r<o&&(o=r));if(s){e.splice(d--,1);var i=n();void 0!==i&&(t=i)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[l,n,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce(function(t,l){return a.f[l](e,t),t},[]))}}(),function(){a.u=function(e){return"js/"+e+".d16a31e0.js"}}(),function(){a.miniCssF=function(e){}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="frontend:";a.l=function(l,n,r,o){if(e[l])e[l].push(n);else{var s,u;if(void 0!==r)for(var i=document.getElementsByTagName("script"),d=0;d<i.length;d++){var c=i[d];if(c.getAttribute("src")==l||c.getAttribute("data-webpack")==t+r){s=c;break}}s||(u=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",t+r),s.src=l),e[l]=[n];var v=function(t,a){s.onerror=s.onload=null,clearTimeout(m);var n=e[l];if(delete e[l],s.parentNode&&s.parentNode.removeChild(s),n&&n.forEach(function(e){return e(a)}),t)return t(a)},m=setTimeout(v.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=v.bind(null,s.onerror),s.onload=v.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){var e={524:0};a.f.j=function(t,l){var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)l.push(n[2]);else{var r=new Promise(function(a,l){n=e[t]=[a,l]});l.push(n[2]=r);var o=a.p+a.u(t),s=new Error,u=function(l){if(a.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var r=l&&("load"===l.type?"missing":l.type),o=l&&l.target&&l.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",s.name="ChunkLoadError",s.type=r,s.request=o,n[1](s)}};a.l(o,u,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,l){var n,r,o=l[0],s=l[1],u=l[2],i=0;if(o.some(function(t){return 0!==e[t]})){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);if(u)var d=u(a)}for(t&&t(l);i<o.length;i++)r=o[i],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},l=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[504],function(){return a(6520)});l=a.O(l)})();
//# sourceMappingURL=app.1629592e.js.map
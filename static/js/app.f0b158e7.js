(function(){"use strict";var e={6520:function(e,t,a){var l=a(5130),n=a(6768),r=a(144),s=a(1387),u=(a(4114),a(4232)),o={__name:"AppHeader",setup(e){const t=(0,s.rd)(),a=(0,s.lq)(),l=[{name:"Главная",path:"/",icon:"mdi-home"},{name:"Задачи",path:"/tasks",icon:"mdi-clipboard-check"},{name:"Работники",path:"/users",icon:"mdi-information"}],r=e=>{a.path!==e&&t.push(e).catch(e=>{console.error("Navigation error:",e)})},o=()=>{r("/")},i=e=>(0,n.EW)(()=>"/"===e?"/"===a.path:a.path.startsWith(e)).value,d=()=>{console.log("Выход из системы"),t.push("/login").catch(e=>{console.error("Logout navigation error:",e)})};return(e,t)=>{const a=(0,n.g2)("v-icon"),s=(0,n.g2)("v-toolbar-title"),c=(0,n.g2)("v-spacer"),v=(0,n.g2)("v-btn"),k=(0,n.g2)("v-list-item-title"),m=(0,n.g2)("v-list-item"),f=(0,n.g2)("v-divider"),g=(0,n.g2)("v-list"),p=(0,n.g2)("v-menu"),b=(0,n.g2)("v-app-bar");return(0,n.uX)(),(0,n.Wv)(b,{app:"",color:"primary",dark:"",elevation:"2"},{default:(0,n.k6)(()=>[(0,n.bF)(s,{class:"cursor-pointer",onClick:o},{default:(0,n.k6)(()=>[(0,n.bF)(a,{left:""},{default:(0,n.k6)(()=>[...t[2]||(t[2]=[(0,n.eW)("mdi-rocket",-1)])]),_:1}),t[3]||(t[3]=(0,n.eW)(" CRM Bakhodur ",-1))]),_:1}),(0,n.bF)(c),((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(l,e=>(0,n.bF)(v,{key:e.name,onClick:t=>r(e.path),color:i(e.path)?"white":"",variant:i(e.path)?"flat":"text",class:"mx-1"},{default:(0,n.k6)(()=>[e.icon?((0,n.uX)(),(0,n.Wv)(a,{key:0,start:""},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(e.icon),1)]),_:2},1024)):(0,n.Q3)("",!0),(0,n.eW)(" "+(0,u.v_)(e.name),1)]),_:2},1032,["onClick","color","variant"])),64)),(0,n.bF)(p,null,{activator:(0,n.k6)(({props:e})=>[(0,n.bF)(v,(0,n.v6)({icon:""},e,{color:i("/profile")?"white":""}),{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[...t[4]||(t[4]=[(0,n.eW)("mdi-account-circle",-1)])]),_:1})]),_:1},16,["color"])]),default:(0,n.k6)(()=>[(0,n.bF)(g,null,{default:(0,n.k6)(()=>[(0,n.bF)(m,{onClick:t[0]||(t[0]=e=>r("/profile"))},{prepend:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[...t[5]||(t[5]=[(0,n.eW)("mdi-account",-1)])]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)(k,null,{default:(0,n.k6)(()=>[...t[6]||(t[6]=[(0,n.eW)("Профиль",-1)])]),_:1})]),_:1}),(0,n.bF)(m,{onClick:t[1]||(t[1]=e=>r("/settings"))},{prepend:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.eW)("mdi-cog",-1)])]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)(k,null,{default:(0,n.k6)(()=>[...t[8]||(t[8]=[(0,n.eW)("Настройки",-1)])]),_:1})]),_:1}),(0,n.bF)(f),(0,n.bF)(m,{onClick:d},{prepend:(0,n.k6)(()=>[(0,n.bF)(a,{color:"error"},{default:(0,n.k6)(()=>[...t[9]||(t[9]=[(0,n.eW)("mdi-logout",-1)])]),_:1})]),default:(0,n.k6)(()=>[(0,n.bF)(k,null,{default:(0,n.k6)(()=>[...t[10]||(t[10]=[(0,n.eW)("Выход",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},i=a(1241);const d=(0,i.A)(o,[["__scopeId","data-v-bd5ec064"]]);var c=d,v={__name:"App",setup(e){const t=(0,s.lq)();return(e,a)=>{const l=(0,n.g2)("router-view"),s=(0,n.g2)("v-main"),u=(0,n.g2)("v-app");return(0,n.uX)(),(0,n.Wv)(u,null,{default:(0,n.k6)(()=>[(0,r.R1)(t).meta.hideHeader?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(c,{key:0})),(0,n.bF)(s,null,{default:(0,n.k6)(()=>[(0,n.bF)(l)]),_:1})]),_:1})}}};const k=v;var m=k,f=a(1114);a(4603),a(7566),a(8721);class g{static async request(e,t){return(new g).request(e,t)}async request(e,t){const a="Content-Type",l={};let n=t.body;if(t.bodyType)switch(t.bodyType){case"HTML":l[a]="text/html";break;case"JS":l[a]="application/javascript";break;case"JSON":l[a]="application/json",n=JSON.stringify(t.body);break;case"Text":l[a]="application/plain";break;case"XML":l[a]="application/xml";break;default:l[a]=t.bodyType;break}else"object"===typeof t.body&&(l["Content-Type"]="application/json",n=JSON.stringify(t.body));try{const a=await fetch(e,{method:t.method,headers:{...l,...t.headers},body:n});if(!a.ok)throw new Error(a?.message||`Ошибка ${a.status}`);return a}catch(r){throw console.log(r?.message),r}}}var p=a(2261);const b="http://localhost:3000",h=(0,p.nY)("auth",{state:()=>({user:null,token:localStorage.getItem("token")||null}),getters:{role:e=>e.user?.role||null,isAuthenticated:e=>!!e.token},actions:{async login({email:e,password:t}){try{const a=await fetch(`${b}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!a.ok){const e=await a.json();throw new Error(e.message||"Неверный логин или пароль")}const{data:l}=await a.json();this.token=l.token,localStorage.setItem("token",this.token),await this.fetchMe()}catch(a){throw this.logout(),a}},async register(e){try{const t=await fetch(`${b}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.message||"Ошибка при регистрации")}const a=await t.json();return console.log("Registration successful:",a),await this.login({email:e.email,password:e.password}),a.data?.userId}catch(t){throw this.logout(),t}},async fetchMe(){if(this.token)try{const e=await fetch(`${b}/api/users/me`,{headers:{Authorization:`Bearer ${this.token}`}});if(!e.ok){if(401===e.status)throw this.logout(),new Error("Сессия истекла");throw new Error("Не удалось загрузить профиль")}const{data:t}=await e.json();this.user=t}catch(e){throw e.message.includes("Сессия истекла")&&this.logout(),e}},logout(){this.user=null,this.token=null,localStorage.removeItem("token")},async init(){if(this.token)try{await this.fetchMe()}catch(e){console.warn("Failed to restore user session:",e.message)}}}});class _{constructor(){(0,f.A)(this,"SERVER","http://localhost:3000")}get headers(){return this.auth=h(),{Authorization:this.auth.token?`Bearer ${this.auth.token}`:""}}async add(e){return g.request(`${this.SERVER}/api/tasks`,{method:"POST",headers:this.headers,body:e})}async removeAssignment(e){return g.request(`${this.SERVER}/api/tasks/unassign-task-from-worker/${e}`,{method:"DELETE",headers:this.headers})}async edit(e,t){return g.request(`${this.SERVER}/api/tasks/${e}`,{method:"PUT",headers:this.headers,body:t})}async delete(e){return g.request(`${this.SERVER}/api/tasks/${e}`,{method:"DELETE",headers:this.headers})}async assignUser(e){return g.request(`${this.SERVER}/api/tasks/assign-task-worker`,{method:"POST",headers:this.headers,body:e})}async getAll(e={}){const t=new URLSearchParams(e).toString();return g.request(`${this.SERVER}/api/tasks${t?`?${t}`:""}`,{headers:this.headers})}async getAssignmentLength(e){return g.request(`${this.SERVER}/api/tasks/assignment-length/${e}`,{headers:this.headers})}}const y=new _,F={key:0,class:"text-red"};var w={__name:"DashboardPage",setup(e){const t=(0,r.KR)({inProgress:0,pending:0,points:0}),a=(0,r.KR)(null),l=[{title:"Имя",key:"name"},{title:"Выполнено задач",key:"tasksCompleted"},{title:"Баллы",key:"points"}],s=[{name:"Иван",tasksCompleted:50,points:1200},{name:"Анна",tasksCompleted:45,points:1100},{name:"Олег",tasksCompleted:30,points:700}];async function o(e){const t=await y.getAll({status:e});if(!t.ok){const e=await t.text();throw new Error(`Ошибка ${t.status}: ${e}`)}return t.json()}return(0,n.sV)(async()=>{try{const e=await o("in_progress");t.value.inProgress=e.data.tasks.length;const a=await o("pending");t.value.pending=a.data.tasks.length;const l=[...e.data.tasks,...a.data.tasks];t.value.points=l.reduce((e,t)=>e+(t.points??0),0)}catch(e){a.value=e.message,console.error("Ошибка загрузки задач:",e)}}),(e,r)=>{const o=(0,n.g2)("v-card-title"),i=(0,n.g2)("v-card-text"),d=(0,n.g2)("v-card"),c=(0,n.g2)("v-col"),v=(0,n.g2)("v-row"),k=(0,n.g2)("v-data-table"),m=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(m,null,{default:(0,n.k6)(()=>[(0,n.bF)(v,null,{default:(0,n.k6)(()=>[(0,n.bF)(c,{cols:"12",md:"3"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(o,null,{default:(0,n.k6)(()=>[...r[0]||(r[0]=[(0,n.eW)("В процессе",-1)])]),_:1}),(0,n.bF)(i,{class:"text-h4"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(t.value.inProgress),1)]),_:1})]),_:1})]),_:1}),(0,n.bF)(c,{cols:"12",md:"3"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(o,null,{default:(0,n.k6)(()=>[...r[1]||(r[1]=[(0,n.eW)("Ожидают",-1)])]),_:1}),(0,n.bF)(i,{class:"text-h4"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(t.value.pending),1)]),_:1})]),_:1})]),_:1}),(0,n.bF)(c,{cols:"12",md:"3"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(o,null,{default:(0,n.k6)(()=>[...r[2]||(r[2]=[(0,n.eW)("Сумма баллов",-1)])]),_:1}),(0,n.bF)(i,{class:"text-h4"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(t.value.points),1)]),_:1})]),_:1})]),_:1})]),_:1}),(0,n.bF)(v,null,{default:(0,n.k6)(()=>[(0,n.bF)(c,{cols:"12",md:"6"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(o,null,{default:(0,n.k6)(()=>[...r[3]||(r[3]=[(0,n.eW)("Задачи по статусу",-1)])]),_:1}),(0,n.bF)(i,null,{default:(0,n.k6)(()=>[...r[4]||(r[4]=[(0,n.Lk)("div",{class:"text-center"},"[Диаграмма]",-1)])]),_:1})]),_:1})]),_:1}),(0,n.bF)(c,{cols:"12",md:"6"},{default:(0,n.k6)(()=>[(0,n.bF)(d,null,{default:(0,n.k6)(()=>[(0,n.bF)(o,null,{default:(0,n.k6)(()=>[...r[5]||(r[5]=[(0,n.eW)("Топ сотрудников",-1)])]),_:1}),(0,n.bF)(k,{headers:l,items:s})]),_:1})]),_:1})]),_:1}),a.value?((0,n.uX)(),(0,n.CE)("div",F,"Ошибка: "+(0,u.v_)(a.value),1)):(0,n.Q3)("",!0)]),_:1})}}};const W=w;var E=W,x={__name:"TaskForm",props:{getTasks:Function},setup(e){const t=(0,r.KR)({title:"",description:""}),a=e,l=a.getTasks,s=(0,r.KR)(!1),u=(0,r.KR)(!1);async function o(){if(t.value.title&&t.value.description)try{u.value=!0;const e=await y.add(t.value);e.ok&&(i(),await l())}finally{u.value=!1}}function i(){s.value=!1,t.value={title:"",description:""}}return(e,a)=>{const d=(0,n.g2)("v-btn"),c=(0,n.g2)("v-card-title"),v=(0,n.g2)("v-row"),k=(0,n.g2)("v-text-field"),m=(0,n.g2)("v-card-text"),f=(0,n.g2)("v-spacer"),g=(0,n.g2)("v-card-actions"),p=(0,n.g2)("v-card"),b=(0,n.g2)("v-dialog"),h=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(h,null,{default:(0,n.k6)(()=>[(0,n.bF)(v,{justify:"center"},{default:(0,n.k6)(()=>[(0,n.bF)(c,null,{default:(0,n.k6)(()=>[(0,n.bF)(d,{color:"primary",onClick:(0,r.R1)(l),class:"mr-2"},{default:(0,n.k6)(()=>[...a[4]||(a[4]=[(0,n.eW)("Обновить",-1)])]),_:1},8,["onClick"]),(0,n.bF)(d,{color:"success",onClick:a[0]||(a[0]=e=>s.value=!0)},{default:(0,n.k6)(()=>[...a[5]||(a[5]=[(0,n.eW)("Добавить задачу",-1)])]),_:1})]),_:1})]),_:1}),(0,n.bF)(b,{modelValue:s.value,"onUpdate:modelValue":a[3]||(a[3]=e=>s.value=e),"max-width":"500px"},{default:(0,n.k6)(()=>[(0,n.bF)(p,null,{default:(0,n.k6)(()=>[(0,n.bF)(c,null,{default:(0,n.k6)(()=>[...a[6]||(a[6]=[(0,n.eW)("Добавить задачу",-1)])]),_:1}),(0,n.bF)(m,null,{default:(0,n.k6)(()=>[(0,n.bF)(k,{modelValue:t.value.title,"onUpdate:modelValue":a[1]||(a[1]=e=>t.value.title=e),label:"Название",required:""},null,8,["modelValue"]),(0,n.bF)(k,{modelValue:t.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value.description=e),label:"Описание",required:""},null,8,["modelValue"])]),_:1}),(0,n.bF)(g,null,{default:(0,n.k6)(()=>[(0,n.bF)(f),(0,n.bF)(d,{text:"",onClick:i},{default:(0,n.k6)(()=>[...a[7]||(a[7]=[(0,n.eW)("Отмена",-1)])]),_:1}),(0,n.bF)(d,{color:"success",onClick:o,loading:u.value},{default:(0,n.k6)(()=>[...a[8]||(a[8]=[(0,n.eW)(" Сохранить ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};const V=x;var R=V;a(8111),a(2489),a(1701);function C(){const e=h(),t=(0,n.EW)(()=>e.role),a=(0,n.EW)(()=>"admin"===t.value),l=(0,n.EW)(()=>"manager"===t.value),r=(0,n.EW)(()=>"worker"===t.value),s=e=>t.value===e,u=e=>e.includes(t.value),o=(0,n.EW)(()=>u(["admin","manager"])),i=(0,n.EW)(()=>u(["admin","manager"])),d=(0,n.EW)(()=>u(["admin","manager"])),c=(0,n.EW)(()=>"worker"===t.value);return{userRole:t,isAdmin:a,isManager:l,isWorker:r,hasRole:s,hasAnyRole:u,canManageUsers:o,canCreateTasks:i,canViewAllTasks:d,canOnlyViewOwnTasks:c}}class K{constructor(){(0,f.A)(this,"SERVER","http://localhost:3000")}get headers(){return this.auth=h(),{Authorization:this.auth.token?`Bearer ${this.auth.token}`:""}}async me(){return g.request(`${this.SERVER}/api/user/me`,{method:"GET",headers:this.headers})}async getAll(){return g.request(`${this.SERVER}/api/users`,{method:"GET",headers:this.headers})}async delete(e){return g.request(`${this.SERVER}/api/users/${e}`,{method:"DELETE",headers:this.headers})}async generateKey(e){return g.request(`${this.SERVER}/api/users/register-key/${e}`,{method:"GET",headers:this.headers})}}const A=new K,X={class:"text-truncate",style:{"max-width":"200px"}},T={class:"d-flex align-center"},$={key:1,class:"text-grey text-caption align-self-center ml-2"};var L={__name:"TaskList",props:{tasks:Array,getTasks:Function},setup(e){const{isAdmin:t}=C(),a=h(),s=(0,n.EW)(()=>e=>t.value||e.createdBy?.id===a.user?.id),o=(0,n.EW)(()=>e=>t.value||e.createdBy?.id===a.user?.id),i=[{label:"Ожидает",value:"pending"},{label:"В процессе",value:"in_progress"},{label:"Завершено",value:"completed"}],d=e,c=(0,r.lW)(d,"tasks"),v=d.getTasks,k=(0,r.KR)([]),m=(0,r.KR)(!1),f=(0,r.KR)([]),g=(0,r.KR)(!1),p=(0,r.KR)(!1),b=(0,r.KR)(!1),_=(0,r.KR)(null),F=(0,r.KR)(null),w=(0,r.KR)(!1),W=(0,r.KR)(!1),E=(0,r.KR)(!1),x=(0,r.KR)(""),V=(0,r.KR)(""),R=e=>{x.value=e,W.value=!0},K=e=>{V.value=e,E.value=!0};async function L(){try{w.value=!0;const e=await A.getAll(),t=await e.json();k.value=t.data.users}catch(e){console.error("Error fetching users:",e),K("Ошибка загрузки пользователей")}finally{w.value=!1}}(0,n.sV)(L);const j=[{title:"Название",key:"title"},{title:"Описание",key:"description"},{title:"Статус",key:"status"},{title:"Создатель",key:"createdBy.name"},{title:"Исполнители",key:"assignments.worker"}];function q(e,{item:t}){S(t)}function S(e){_.value={...e,workerIds:e.assignments?.map(e=>e.userId)||[]},g.value=!0}function U(){g.value=!1,_.value=null}function O(e){F.value=e,p.value=!0,g.value=!1}function I(e){_.value.workerIds=_.value.workerIds.filter(t=>t!==e)}async function Q(e,t){for(const a of t){const e=await y.removeAssignment(a.id);if(!e.ok)throw new Error(`Ошибка при удалении назначения ${a.id}`)}}async function P(){if(_.value.title&&_.value.description&&_.value.status)try{b.value=!0;const e=await y.edit(_.value.id,{title:_.value.title,description:_.value.description,status:_.value.status});if(!e.ok)throw new Error("Ошибка при обновлении задачи");_.value.assignments?.length>0&&await Q(_.value.id,_.value.assignments);for(const t of _.value.workerIds){const e=await y.assignUser({taskId:_.value.id,userId:t});if(!e.ok)throw new Error("Ошибка назначения пользователя")}await v(),U(),R("Задача успешно обновлена")}catch(e){console.error("Error saving task:",e),K(e.message||"Ошибка при сохранении задачи")}finally{b.value=!1}else K("Пожалуйста, заполните все обязательные поля")}async function z(){if(F.value)try{f.value.push(F.value.id);const e=await y.delete(F.value.id);if(!e.ok)throw new Error("Ошибка при удалении задачи");await v(),R("Задача успешно удалена")}catch(e){console.error("Error deleting task:",e),K(e.message||"Ошибка при удалении задачи")}finally{f.value=f.value.filter(e=>e!==F.value.id),p.value=!1,F.value=null}}function M(e){switch(e){case"admin":return"red";case"manager":return"blue";case"worker":return"green";default:return"grey"}}function B(e){switch(e){case"completed":return"green";case"in_progress":return"blue";case"pending":return"orange";default:return"grey"}}function N(e){switch(e){case"completed":return"Завершено";case"in_progress":return"В процессе";case"pending":return"Ожидает";default:return e}}return(e,d)=>{const v=(0,n.g2)("v-badge"),h=(0,n.g2)("v-btn"),y=(0,n.g2)("v-list-item-title"),R=(0,n.g2)("v-chip"),C=(0,n.g2)("v-list-item"),K=(0,n.g2)("v-list"),A=(0,n.g2)("v-menu"),L=(0,n.g2)("v-data-table"),S=(0,n.g2)("v-card"),Q=(0,n.g2)("v-col"),D=(0,n.g2)("v-row"),G=(0,n.g2)("v-card-title"),H=(0,n.g2)("v-text-field"),J=(0,n.g2)("v-textarea"),Y=(0,n.g2)("v-select"),Z=(0,n.g2)("v-icon"),ee=(0,n.g2)("v-avatar"),te=(0,n.g2)("v-alert"),ae=(0,n.g2)("v-container"),le=(0,n.g2)("v-card-text"),ne=(0,n.g2)("v-spacer"),re=(0,n.g2)("v-card-actions"),se=(0,n.g2)("v-dialog"),ue=(0,n.g2)("v-snackbar");return(0,n.uX)(),(0,n.Wv)(ae,null,{default:(0,n.k6)(()=>[(0,n.bF)(D,{justify:"center"},{default:(0,n.k6)(()=>[(0,n.bF)(Q,{cols:"12",md:"10"},{default:(0,n.k6)(()=>[(0,n.bF)(S,null,{default:(0,n.k6)(()=>[(0,n.bF)(L,{headers:j,items:c.value,"item-key":"id",class:"elevation-1",loading:m.value,"onClick:row":q,hover:""},{"item.title":(0,n.k6)(({item:e})=>[(0,n.eW)((0,u.v_)(e.title),1)]),"item.description":(0,n.k6)(({item:e})=>[(0,n.Lk)("div",X,(0,u.v_)(e.description),1)]),"item.assignments.worker":(0,n.k6)(({item:e})=>[e.assignments&&e.assignments.length>0?((0,n.uX)(),(0,n.Wv)(A,{key:0,onClick:d[0]||(d[0]=(0,l.D$)(()=>{},["stop"]))},{activator:(0,n.k6)(({props:t})=>[(0,n.bF)(h,(0,n.v6)(t,{color:"green",size:"small",variant:"tonal"}),{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(e.assignments[0]?.user?.name||"Без имени")+" ",1),e.assignments.length>1?((0,n.uX)(),(0,n.Wv)(v,{key:0,content:e.assignments.length,color:"primary",inline:""},null,8,["content"])):(0,n.Q3)("",!0)]),_:2},1040)]),default:(0,n.k6)(()=>[(0,n.bF)(K,{density:"compact"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.assignments,e=>((0,n.uX)(),(0,n.Wv)(C,{key:e.id},{append:(0,n.k6)(()=>[(0,n.bF)(R,{size:"x-small",color:M(e.user?.role)},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(e.user?.role),1)]),_:2},1032,["color"])]),default:(0,n.k6)(()=>[(0,n.bF)(y,{class:"text-body-2"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(e.user?.name||"Без имени"),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):((0,n.uX)(),(0,n.Wv)(R,{key:1,color:"grey",variant:"outlined",size:"small"},{default:(0,n.k6)(()=>[...d[11]||(d[11]=[(0,n.eW)(" Не назначен ",-1)])]),_:1}))]),"item.status":(0,n.k6)(({item:e})=>[(0,n.bF)(R,{color:B(e?.status),variant:"flat",size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(N(e?.status)),1)]),_:2},1032,["color"])]),"item.createdBy.name":(0,n.k6)(({item:e})=>[(0,n.Lk)("div",T,[(0,n.Lk)("span",null,(0,u.v_)(e.createdBy?.name||"Неизвестно"),1),e.createdBy?.id===(0,r.R1)(a).user?.id?((0,n.uX)(),(0,n.Wv)(R,{key:0,color:"primary",size:"x-small",class:"ml-2"},{default:(0,n.k6)(()=>[...d[12]||(d[12]=[(0,n.eW)(" Ваша ",-1)])]),_:1})):(0,n.Q3)("",!0)])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),(0,n.bF)(se,{modelValue:g.value,"onUpdate:modelValue":d[6]||(d[6]=e=>g.value=e),"max-width":"700px"},{default:(0,n.k6)(()=>[_.value?((0,n.uX)(),(0,n.Wv)(S,{key:0},{default:(0,n.k6)(()=>[(0,n.bF)(G,null,{default:(0,n.k6)(()=>[d[14]||(d[14]=(0,n.Lk)("span",{class:"text-h6"},"Редактировать задачу",-1)),_.value?.createdBy?.id!==(0,r.R1)(a).user?.id||(0,r.R1)(t)?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(R,{key:0,color:"primary",size:"small",class:"ml-3"},{default:(0,n.k6)(()=>[...d[13]||(d[13]=[(0,n.eW)(" Ваша задача ",-1)])]),_:1}))]),_:1}),(0,n.bF)(le,null,{default:(0,n.k6)(()=>[(0,n.bF)(ae,null,{default:(0,n.k6)(()=>[(0,n.bF)(D,null,{default:(0,n.k6)(()=>[(0,n.bF)(Q,{cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(H,{modelValue:_.value.title,"onUpdate:modelValue":d[1]||(d[1]=e=>_.value.title=e),label:"Название задачи",required:"",rules:[e=>!!e||"Название обязательно"],variant:"outlined",disabled:!s.value(_.value)},null,8,["modelValue","rules","disabled"])]),_:1}),(0,n.bF)(Q,{cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(J,{modelValue:_.value.description,"onUpdate:modelValue":d[2]||(d[2]=e=>_.value.description=e),label:"Описание задачи",required:"",rules:[e=>!!e||"Описание обязательно"],rows:"3",variant:"outlined",disabled:!s.value(_.value)},null,8,["modelValue","rules","disabled"])]),_:1}),(0,n.bF)(Q,{cols:"12",md:"6"},{default:(0,n.k6)(()=>[(0,n.bF)(Y,{modelValue:_.value.status,"onUpdate:modelValue":d[3]||(d[3]=e=>_.value.status=e),items:i,"item-title":"label","item-value":"value",label:"Статус задачи",variant:"outlined",disabled:!s.value(_.value)},null,8,["modelValue","disabled"])]),_:1}),(0,n.bF)(Q,{cols:"12",md:"6"},{default:(0,n.k6)(()=>[(0,n.bF)(R,{color:B(_.value.status),class:"mt-4"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(N(_.value.status)),1)]),_:1},8,["color"])]),_:1}),(0,n.bF)(Q,{cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(Y,{modelValue:_.value.workerIds,"onUpdate:modelValue":d[4]||(d[4]=e=>_.value.workerIds=e),items:k.value,"item-title":"name","item-value":"id",label:"Назначить пользователей",multiple:"",chips:"","closable-chips":"",loading:w.value,variant:"outlined",disabled:!s.value(_.value)},{selection:(0,n.k6)(({item:e,index:t})=>[t<3?((0,n.uX)(),(0,n.Wv)(R,{key:0,size:"small",closable:"",color:M(e.raw.role),variant:"tonal","onClick:close":t=>I(e.raw.id)},{default:(0,n.k6)(()=>[(0,n.bF)(Z,{start:"",size:"16"},{default:(0,n.k6)(()=>[...d[15]||(d[15]=[(0,n.eW)("mdi-account",-1)])]),_:1}),(0,n.eW)(" "+(0,u.v_)(e.title),1)]),_:2},1032,["color","onClick:close"])):(0,n.Q3)("",!0),3===t?((0,n.uX)(),(0,n.CE)("span",$," (+"+(0,u.v_)(_.value.workerIds.length-3)+" других) ",1)):(0,n.Q3)("",!0)]),item:(0,n.k6)(({props:e,item:t})=>[(0,n.bF)(C,(0,n.v6)(e,{title:t.title}),{prepend:(0,n.k6)(()=>[(0,n.bF)(ee,{size:"32",color:M(t.raw.role)},{default:(0,n.k6)(()=>[(0,n.bF)(Z,null,{default:(0,n.k6)(()=>[...d[16]||(d[16]=[(0,n.eW)("mdi-account",-1)])]),_:1})]),_:1},8,["color"])]),append:(0,n.k6)(()=>[(0,n.bF)(R,{size:"x-small",color:M(t.raw.role)},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(t.raw.role),1)]),_:2},1032,["color"]),_.value.workerIds.includes(t.value)?((0,n.uX)(),(0,n.Wv)(Z,{key:0,color:"success",class:"ml-2"},{default:(0,n.k6)(()=>[...d[17]||(d[17]=[(0,n.eW)(" mdi-check ",-1)])]),_:1})):(0,n.Q3)("",!0)]),_:2},1040,["title"])]),"no-data":(0,n.k6)(()=>[(0,n.bF)(C,null,{default:(0,n.k6)(()=>[(0,n.bF)(y,null,{default:(0,n.k6)(()=>[...d[18]||(d[18]=[(0,n.eW)("Пользователи не найдены",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading","disabled"])]),_:1}),0===_.value.workerIds.length?((0,n.uX)(),(0,n.Wv)(Q,{key:0,cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(te,{type:"warning",variant:"tonal",density:"compact"},{default:(0,n.k6)(()=>[...d[19]||(d[19]=[(0,n.eW)(" Задача не назначена ни одному пользователю ",-1)])]),_:1})]),_:1})):(0,n.Q3)("",!0),s.value(_.value)?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(Q,{key:1,cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(te,{type:"info",variant:"tonal",density:"compact"},{default:(0,n.k6)(()=>[...d[20]||(d[20]=[(0,n.eW)(" У вас нет прав на редактирование этой задачи ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),(0,n.bF)(re,null,{default:(0,n.k6)(()=>[o.value(_.value)?((0,n.uX)(),(0,n.Wv)(h,{key:0,color:"error",variant:"text",onClick:d[5]||(d[5]=e=>O(_.value)),loading:f.value.includes(_.value.id)},{default:(0,n.k6)(()=>[...d[21]||(d[21]=[(0,n.eW)(" Удалить ",-1)])]),_:1},8,["loading"])):(0,n.Q3)("",!0),(0,n.bF)(ne),(0,n.bF)(h,{variant:"text",onClick:U},{default:(0,n.k6)(()=>[...d[22]||(d[22]=[(0,n.eW)(" Закрыть ",-1)])]),_:1}),s.value(_.value)?((0,n.uX)(),(0,n.Wv)(h,{key:1,color:"success",onClick:P,loading:b.value,disabled:!_.value.title||!_.value.description},{default:(0,n.k6)(()=>[...d[23]||(d[23]=[(0,n.eW)(" Сохранить изменения ",-1)])]),_:1},8,["loading","disabled"])):(0,n.Q3)("",!0)]),_:1})]),_:1})):(0,n.Q3)("",!0)]),_:1},8,["modelValue"]),(0,n.bF)(se,{modelValue:p.value,"onUpdate:modelValue":d[8]||(d[8]=e=>p.value=e),"max-width":"400px"},{default:(0,n.k6)(()=>[(0,n.bF)(S,null,{default:(0,n.k6)(()=>[(0,n.bF)(G,{class:"text-h6"},{default:(0,n.k6)(()=>[...d[24]||(d[24]=[(0,n.eW)(" Подтвердите удаление ",-1)])]),_:1}),(0,n.bF)(le,null,{default:(0,n.k6)(()=>[(0,n.eW)(' Вы уверены, что хотите удалить задачу "'+(0,u.v_)(F.value?.title)+'"? Это действие нельзя отменить. ',1)]),_:1}),(0,n.bF)(re,null,{default:(0,n.k6)(()=>[(0,n.bF)(ne),(0,n.bF)(h,{variant:"text",onClick:d[7]||(d[7]=e=>p.value=!1)},{default:(0,n.k6)(()=>[...d[25]||(d[25]=[(0,n.eW)(" Отмена ",-1)])]),_:1}),(0,n.bF)(h,{color:"error",onClick:z,loading:f.value.includes(F.value?.id)},{default:(0,n.k6)(()=>[...d[26]||(d[26]=[(0,n.eW)(" Удалить ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,n.bF)(ue,{modelValue:W.value,"onUpdate:modelValue":d[9]||(d[9]=e=>W.value=e),color:"success",timeout:"3000"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(x.value),1)]),_:1},8,["modelValue"]),(0,n.bF)(ue,{modelValue:E.value,"onUpdate:modelValue":d[10]||(d[10]=e=>E.value=e),color:"error",timeout:"5000"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(V.value),1)]),_:1},8,["modelValue"])]),_:1})}}};const j=L;var q=j,S={__name:"TaskManager",setup(e){const t=(0,r.KR)([]),a=(0,r.KR)(null),l=[{label:"Ожидает",value:"pending"},{label:"В процессе",value:"in_progress"},{label:"Завершено",value:"completed"},{label:"Все",value:null}];async function s(){try{const e={};a.value&&(e.status=a.value);const l=await y.getAll(e),n=await l.json();t.value=n.data.tasks,console.log(n.data.tasks)}catch(e){console.error("Error fetching tasks:",e)}}return(0,n.sV)(s),(0,n.wB)(a,()=>{s()}),(e,r)=>{const u=(0,n.g2)("v-select"),o=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.bF)(o,{md:"5"},{default:(0,n.k6)(()=>[(0,n.bF)(u,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=e=>a.value=e),items:l,"item-title":"label","item-value":"value",label:"Фильтр по статусу",class:"mb-1",chips:"","closable-chips":""},null,8,["modelValue"])]),_:1}),(0,n.bF)(R,{getTasks:s}),(0,n.bF)(q,{getTasks:s,tasks:t.value},null,8,["tasks"])],64)}}};const U=S;var O=U;a(8237);const I={class:"text-center"},Q={class:"text-h3 font-weight-bold"},P={class:"text-subtitle-1 mt-2"},z={class:"d-flex align-center justify-space-between"},M={class:"text-h4 font-weight-bold"};var B={__name:"UserList",props:{users:Array,getUsers:Function},setup(e){const t=e,a=(0,r.lW)(t,"users"),s=t.getUsers,o=(0,r.KR)([]),i=(0,r.KR)(!1),d=(0,r.KR)(null),c=(0,r.KR)(null),v=(0,r.KR)(!1),k=[{title:"Имя",key:"name"},{title:"Почта",key:"email"},{title:"Роль",key:"role"},{title:"Активный",key:"isActive"},{title:"Действия",key:"actions",sortable:!1}],m=(0,n.EW)(()=>c.value?c.value.reduce((e,t)=>e+parseInt(t.count),0):0);async function f(e,{item:t}){d.value=t,i.value=!0,await g(t.id)}async function g(e){try{v.value=!0;const t=await y.getAssignmentLength(e),a=await t.json();a.rows&&a.rows.length>0?c.value=a.rows:c.value=null}catch(t){console.error("Error loading user stats:",t),c.value=null}finally{v.value=!1}}function p(){i.value=!1,d.value=null,c.value=null}async function b(e){try{o.value.push(e);const t=await A.delete(e);t.ok&&await s()}catch(t){console.error("Error deleting user:",t)}finally{o.value=o.value.filter(t=>t!==e)}}function h(e){switch(e){case"admin":return"red";case"manager":return"blue";case"worker":return"green";default:return"grey"}}function _(e){switch(e){case"completed":return"green";case"in_progress":return"blue";case"pending":return"orange";default:return"grey"}}function F(e){switch(e){case"completed":return"Завершено";case"in_progress":return"В процессе";case"pending":return"Ожидает";default:return e}}return(e,t)=>{const r=(0,n.g2)("v-chip"),s=(0,n.g2)("v-btn"),g=(0,n.g2)("v-data-table"),y=(0,n.g2)("v-card"),w=(0,n.g2)("v-col"),W=(0,n.g2)("v-row"),E=(0,n.g2)("v-card-title"),x=(0,n.g2)("v-card-subtitle"),V=(0,n.g2)("v-progress-circular"),R=(0,n.g2)("v-container"),C=(0,n.g2)("v-divider"),K=(0,n.g2)("v-alert"),A=(0,n.g2)("v-card-text"),X=(0,n.g2)("v-spacer"),T=(0,n.g2)("v-card-actions"),$=(0,n.g2)("v-dialog");return(0,n.uX)(),(0,n.Wv)(R,null,{default:(0,n.k6)(()=>[(0,n.bF)(W,{justify:"center"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{cols:"14",md:"10"},{default:(0,n.k6)(()=>[(0,n.bF)(y,null,{default:(0,n.k6)(()=>[(0,n.bF)(g,{headers:k,items:a.value,"item-key":"id",class:"elevation-1","onClick:row":f,hover:""},{"item.name":(0,n.k6)(({item:e})=>[(0,n.eW)((0,u.v_)(e.name),1)]),"item.email":(0,n.k6)(({item:e})=>[(0,n.eW)((0,u.v_)(e.email),1)]),"item.role":(0,n.k6)(({item:e})=>[(0,n.bF)(r,{color:h(e.role),size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(e.role),1)]),_:2},1032,["color"])]),"item.isActive":(0,n.k6)(({item:e})=>[(0,n.bF)(r,{color:e.isActive?"green":"red",size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(e.isActive?"Активен":"Неактивен"),1)]),_:2},1032,["color"])]),"item.actions":(0,n.k6)(({item:e})=>[(0,n.Lk)("div",{onClick:t[0]||(t[0]=(0,l.D$)(()=>{},["stop"]))},[(0,n.bF)(s,{color:"red",size:"small",variant:"outlined",onClick:t=>b(e.id),loading:o.value.includes(e.id)},{default:(0,n.k6)(()=>[...t[2]||(t[2]=[(0,n.eW)(" Удалить ",-1)])]),_:1},8,["onClick","loading"])])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),(0,n.bF)($,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),"max-width":"600px"},{default:(0,n.k6)(()=>[d.value?((0,n.uX)(),(0,n.Wv)(y,{key:0},{default:(0,n.k6)(()=>[(0,n.bF)(E,null,{default:(0,n.k6)(()=>[...t[3]||(t[3]=[(0,n.Lk)("span",{class:"text-h6"},"Статистика задач",-1)])]),_:1}),(0,n.bF)(x,{class:"mt-2"},{default:(0,n.k6)(()=>[(0,n.eW)(" Пользователь: "+(0,u.v_)(d.value.name),1)]),_:1}),(0,n.bF)(A,null,{default:(0,n.k6)(()=>[v.value?((0,n.uX)(),(0,n.Wv)(R,{key:0},{default:(0,n.k6)(()=>[(0,n.bF)(W,{justify:"center"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{cols:"12",class:"text-center"},{default:(0,n.k6)(()=>[(0,n.bF)(V,{indeterminate:"",color:"primary"}),t[4]||(t[4]=(0,n.Lk)("p",{class:"mt-4"},"Загрузка статистики...",-1))]),_:1})]),_:1})]),_:1})):c.value?((0,n.uX)(),(0,n.Wv)(R,{key:1},{default:(0,n.k6)(()=>[(0,n.bF)(W,null,{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c.value,e=>((0,n.uX)(),(0,n.Wv)(w,{cols:"12",md:"4",key:e.status},{default:(0,n.k6)(()=>[(0,n.bF)(y,{color:_(e.status),variant:"tonal",class:"pa-4"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",I,[(0,n.Lk)("div",Q,(0,u.v_)(e.count),1),(0,n.Lk)("div",P,(0,u.v_)(F(e.status)),1)])]),_:2},1032,["color"])]),_:2},1024))),128)),(0,n.bF)(w,{cols:"12",class:"mt-4"},{default:(0,n.k6)(()=>[(0,n.bF)(C)]),_:1}),(0,n.bF)(w,{cols:"12"},{default:(0,n.k6)(()=>[(0,n.bF)(y,{variant:"outlined",class:"pa-4"},{default:(0,n.k6)(()=>[(0,n.Lk)("div",z,[t[5]||(t[5]=(0,n.Lk)("span",{class:"text-h6"},"Всего задач:",-1)),(0,n.Lk)("span",M,(0,u.v_)(m.value),1)])]),_:1})]),_:1})]),_:1})]),_:1})):((0,n.uX)(),(0,n.Wv)(R,{key:2},{default:(0,n.k6)(()=>[(0,n.bF)(K,{type:"info",variant:"tonal"},{default:(0,n.k6)(()=>[...t[6]||(t[6]=[(0,n.eW)(" У пользователя пока нет назначенных задач ",-1)])]),_:1})]),_:1}))]),_:1}),(0,n.bF)(T,null,{default:(0,n.k6)(()=>[(0,n.bF)(X),(0,n.bF)(s,{variant:"text",onClick:p},{default:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.eW)(" Закрыть ",-1)])]),_:1})]),_:1})]),_:1})):(0,n.Q3)("",!0)]),_:1},8,["modelValue"])]),_:1})}}};const N=(0,i.A)(B,[["__scopeId","data-v-5c77d70f"]]);var D=N;const G={class:"d-flex align-center"},H={class:"mb-3"},J={class:"d-flex gap-2"};var Y={__name:"GenerateKey",setup(e){const t=(0,r.KR)(""),a=(0,r.KR)(""),l=(0,r.KR)(!1),s=(0,r.KR)(!1),o=(0,r.KR)(""),i=[{title:"Менеджер",value:"manager"},{title:"Работник",value:"worker"}],d=async()=>{try{if(!t.value)return;const e=await A.generateKey(t.value),l=await e.json();if(!e.ok)throw new Error(l.message||"Ошибка при генерации ключа");a.value=l.data.key}catch(e){o.value=e.message||"Ошибка при генерации ключа",s.value=!0}},c=async()=>{try{await navigator.clipboard.writeText(a.value),l.value=!0}catch(e){o.value="Не удалось скопировать ключ",s.value=!0}},v=async()=>{const e={title:"Ключ доступа",text:`Ключ доступа (${m(t.value)}): ${a.value}`,url:window.location.href};try{navigator.share?await navigator.share(e):(await navigator.clipboard.writeText(e.text),l.value=!0)}catch(n){o.value="Не удалось поделиться ключом",s.value=!0}},k=e=>{const t={manager:"orange",worker:"blue"};return t[e]||"grey"},m=e=>{const t=i.find(t=>t.value===e);return t?t.title:""};return(e,r)=>{const f=(0,n.g2)("v-card-title"),g=(0,n.g2)("v-select"),p=(0,n.g2)("v-btn"),b=(0,n.g2)("v-chip"),h=(0,n.g2)("v-divider"),_=(0,n.g2)("v-text-field"),y=(0,n.g2)("v-card-text"),F=(0,n.g2)("v-card"),w=(0,n.g2)("v-snackbar"),W=(0,n.g2)("v-col"),E=(0,n.g2)("v-row"),x=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(x,null,{default:(0,n.k6)(()=>[(0,n.bF)(E,{justify:"center"},{default:(0,n.k6)(()=>[e.isAdmin?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(W,{key:0,cols:"10",md:"5"},{default:(0,n.k6)(()=>[(0,n.bF)(F,null,{default:(0,n.k6)(()=>[(0,n.bF)(f,null,{default:(0,n.k6)(()=>[...r[5]||(r[5]=[(0,n.eW)("Сгенерировать ключ",-1)])]),_:1}),(0,n.bF)(y,null,{default:(0,n.k6)(()=>[(0,n.bF)(g,{modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=e=>t.value=e),items:i,"item-title":"title","item-value":"value",label:"Выберите роль",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),(0,n.bF)(p,{color:"primary",onClick:d,disabled:!t.value,block:"",class:"mb-4"},{default:(0,n.k6)(()=>[...r[6]||(r[6]=[(0,n.eW)(" Сгенерировать ключ ",-1)])]),_:1},8,["disabled"]),a.value?((0,n.uX)(),(0,n.Wv)(F,{key:0,variant:"outlined",class:"mb-4"},{default:(0,n.k6)(()=>[(0,n.bF)(y,null,{default:(0,n.k6)(()=>[(0,n.Lk)("div",G,[(0,n.bF)(b,{color:k(t.value),class:"me-2"},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(m(t.value)),1)]),_:1},8,["color"]),r[7]||(r[7]=(0,n.Lk)("span",{class:"text-caption text-medium-emphasis"}," Роль ",-1))]),(0,n.bF)(h,{class:"my-3"}),(0,n.Lk)("div",H,[r[8]||(r[8]=(0,n.Lk)("div",{class:"text-subtitle-2 mb-2"},"Сгенерированный ключ:",-1)),(0,n.bF)(_,{"model-value":a.value,readonly:"",variant:"outlined",density:"compact",class:"key-field"},{"append-inner":(0,n.k6)(()=>[(0,n.bF)(p,{icon:"mdi-content-copy",size:"small",variant:"text",onClick:c})]),_:1},8,["model-value"])]),(0,n.Lk)("div",J,[(0,n.bF)(p,{color:"success",variant:"outlined","prepend-icon":"mdi-content-copy",onClick:c},{default:(0,n.k6)(()=>[...r[9]||(r[9]=[(0,n.eW)(" Копировать ",-1)])]),_:1}),(0,n.bF)(p,{color:"primary",variant:"outlined","prepend-icon":"mdi-share",onClick:v},{default:(0,n.k6)(()=>[...r[10]||(r[10]=[(0,n.eW)(" Поделиться ",-1)])]),_:1})])]),_:1})]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(w,{modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=e=>l.value=e),color:"success",timeout:"2000"},{actions:(0,n.k6)(()=>[(0,n.bF)(p,{variant:"text",onClick:r[1]||(r[1]=e=>l.value=!1)},{default:(0,n.k6)(()=>[...r[11]||(r[11]=[(0,n.eW)(" Закрыть ",-1)])]),_:1})]),default:(0,n.k6)(()=>[r[12]||(r[12]=(0,n.eW)(" Ключ скопирован в буфер обмена! ",-1))]),_:1},8,["modelValue"]),(0,n.bF)(w,{modelValue:s.value,"onUpdate:modelValue":r[4]||(r[4]=e=>s.value=e),color:"error",timeout:"3000"},{actions:(0,n.k6)(()=>[(0,n.bF)(p,{variant:"text",onClick:r[3]||(r[3]=e=>s.value=!1)},{default:(0,n.k6)(()=>[...r[13]||(r[13]=[(0,n.eW)(" Закрыть ",-1)])]),_:1})]),default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(o.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1})}}};const Z=(0,i.A)(Y,[["__scopeId","data-v-ca72003c"]]);var ee=Z,te={__name:"UserManager",setup(e){const{isAdmin:t}=C(),a=(0,r.KR)([]);async function l(){try{const e=await A.getAll(),t=await e.json();console.log(t.data.users),a.value=t.data.users}catch(e){console.error("Error fetching tasks:",e)}}return(0,n.sV)(l),(e,s)=>((0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.bF)(D,{getUsers:l,users:a.value},null,8,["users"]),(0,r.R1)(t)?((0,n.uX)(),(0,n.Wv)(ee,{key:0})):(0,n.Q3)("",!0)],64))}};const ae=te;var le=ae;const ne={class:"text-center"};var re={__name:"LoginPage",setup(e){const t=h(),a=(0,s.rd)(),o=(0,r.KR)(""),i=(0,r.KR)(""),d=(0,r.KR)(""),c=(0,r.KR)(!1),v=async()=>{d.value="",c.value=!0;try{await t.login({email:o.value,password:i.value}),a.push("/tasks")}catch(e){d.value=e.message}finally{c.value=!1}};return(e,t)=>{const a=(0,n.g2)("v-card-title"),r=(0,n.g2)("v-text-field"),s=(0,n.g2)("v-alert"),k=(0,n.g2)("v-btn"),m=(0,n.g2)("v-form"),f=(0,n.g2)("v-divider"),g=(0,n.g2)("v-card-text"),p=(0,n.g2)("v-card"),b=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(b,{class:"d-flex justify-center align-center fill-height"},{default:(0,n.k6)(()=>[(0,n.bF)(p,{class:"pa-6",width:"400"},{default:(0,n.k6)(()=>[(0,n.bF)(a,{class:"text-h6"},{default:(0,n.k6)(()=>[...t[3]||(t[3]=[(0,n.eW)("Login",-1)])]),_:1}),(0,n.bF)(g,null,{default:(0,n.k6)(()=>[(0,n.bF)(m,{onSubmit:(0,l.D$)(v,["prevent"]),ref:"form"},{default:(0,n.k6)(()=>[(0,n.bF)(r,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),label:"Email",type:"email","prepend-icon":"mdi-email",required:""},null,8,["modelValue"]),(0,n.bF)(r,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),label:"Password",type:"password","prepend-icon":"mdi-lock",required:""},null,8,["modelValue"]),d.value?((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"error",class:"mb-4",dense:""},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(d.value),1)]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(k,{type:"submit",color:"primary",block:"",loading:c.value},{default:(0,n.k6)(()=>[...t[4]||(t[4]=[(0,n.eW)(" Войти ",-1)])]),_:1},8,["loading"])]),_:1},512),(0,n.bF)(f,{class:"my-4"}),(0,n.Lk)("div",ne,[t[6]||(t[6]=(0,n.Lk)("span",{class:"text-body-2"},"Нет аккаунта?",-1)),(0,n.bF)(k,{variant:"text",color:"primary",onClick:t[2]||(t[2]=t=>e.$router.push("/register")),class:"ml-2"},{default:(0,n.k6)(()=>[...t[5]||(t[5]=[(0,n.eW)(" Зарегистрироваться ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})}}};const se=re;var ue=se;const oe={class:"text-center"};var ie={__name:"RegisterPage",setup(e){const t=h(),a=(0,s.rd)(),o=(0,r.KR)(""),i=(0,r.KR)(""),d=(0,r.KR)(""),c=(0,r.KR)(""),v=(0,r.KR)(""),k=(0,r.KR)(!1),m=async()=>{v.value="",k.value=!0;try{await t.register({name:o.value,email:i.value,password:d.value,key:c.value}),a.push("/tasks")}catch(e){v.value=e.message}finally{k.value=!1}};return(e,t)=>{const a=(0,n.g2)("v-card-title"),r=(0,n.g2)("v-text-field"),s=(0,n.g2)("v-alert"),f=(0,n.g2)("v-btn"),g=(0,n.g2)("v-form"),p=(0,n.g2)("v-divider"),b=(0,n.g2)("v-card-text"),h=(0,n.g2)("v-card"),_=(0,n.g2)("v-container");return(0,n.uX)(),(0,n.Wv)(_,{class:"d-flex justify-center align-center fill-height"},{default:(0,n.k6)(()=>[(0,n.bF)(h,{class:"pa-6",width:"400"},{default:(0,n.k6)(()=>[(0,n.bF)(a,{class:"text-h6"},{default:(0,n.k6)(()=>[...t[5]||(t[5]=[(0,n.eW)("Регистрация",-1)])]),_:1}),(0,n.bF)(b,null,{default:(0,n.k6)(()=>[(0,n.bF)(g,{onSubmit:(0,l.D$)(m,["prevent"]),ref:"form"},{default:(0,n.k6)(()=>[(0,n.bF)(r,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),label:"Имя","prepend-icon":"mdi-account",required:""},null,8,["modelValue"]),(0,n.bF)(r,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),label:"Email",type:"email","prepend-icon":"mdi-email",required:""},null,8,["modelValue"]),(0,n.bF)(r,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),label:"Пароль",type:"password","prepend-icon":"mdi-lock",required:""},null,8,["modelValue"]),(0,n.bF)(r,{modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=e=>c.value=e),label:"Ключ регистрации","prepend-icon":"mdi-key",required:""},null,8,["modelValue"]),v.value?((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"error",class:"mb-4",dense:""},{default:(0,n.k6)(()=>[(0,n.eW)((0,u.v_)(v.value),1)]),_:1})):(0,n.Q3)("",!0),(0,n.bF)(f,{type:"submit",color:"primary",block:"",loading:k.value},{default:(0,n.k6)(()=>[...t[6]||(t[6]=[(0,n.eW)(" Зарегистрироваться ",-1)])]),_:1},8,["loading"])]),_:1},512),(0,n.bF)(p,{class:"my-4"}),(0,n.Lk)("div",oe,[t[8]||(t[8]=(0,n.Lk)("span",{class:"text-body-2"},"Уже есть аккаунт?",-1)),(0,n.bF)(f,{variant:"text",color:"primary",onClick:t[4]||(t[4]=t=>e.$router.push("/login")),class:"ml-2"},{default:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.eW)(" Войти ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})}}};const de=ie;var ce=de;const ve=[{path:"/tasks",name:"tasks",component:O,meta:{requiresAuth:!0,roles:["admin","manager","worker"]}},{path:"/users",name:"users",component:le,meta:{requiresAuth:!0,roles:["admin","manager"]}},{path:"/",name:"dashboard",component:E,meta:{requiresAuth:!0,roles:["admin","manager"]}},{path:"/login",name:"login",component:ue,meta:{hideHeader:!0,requiresGuest:!0}},{path:"/register",name:"register",component:ce,meta:{hideHeader:!0,requiresGuest:!0}},{path:"/forbidden",name:"forbidden",component:()=>a.e(156).then(a.bind(a,1156)),meta:{hideHeader:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}],ke=(0,s.aE)({history:(0,s.LA)(),routes:ve});ke.beforeEach(async(e,t,a)=>{const l=h();if(l.token&&!l.user)try{await l.fetchMe()}catch(n){console.warn("Failed to fetch user during navigation:",n.message)}if(e.meta.requiresAuth&&!l.isAuthenticated)return a("/login");if(e.meta.requiresGuest&&l.isAuthenticated)return a("/");if(e.meta.roles&&l.isAuthenticated){const t=l.role,n=e.meta.roles;if(!n.includes(t))return console.warn(`Access denied. User role: ${t}, Required roles: ${n}`),a("/forbidden")}a()});var me=ke,fe=(a(5524),a(5753)),ge=a(2801),pe=a(3425);const be=(0,fe.$N)({components:ge,directives:pe});(0,l.Ef)(m).use((0,p.Ey)()).use(me).use(be).mount("#app")}},t={};function a(l){var n=t[l];if(void 0!==n)return n.exports;var r=t[l]={exports:{}};return e[l].call(r.exports,r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,l,n,r){if(!l){var s=1/0;for(d=0;d<e.length;d++){l=e[d][0],n=e[d][1],r=e[d][2];for(var u=!0,o=0;o<l.length;o++)(!1&r||s>=r)&&Object.keys(a.O).every(function(e){return a.O[e](l[o])})?l.splice(o--,1):(u=!1,r<s&&(s=r));if(u){e.splice(d--,1);var i=n();void 0!==i&&(t=i)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[l,n,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce(function(t,l){return a.f[l](e,t),t},[]))}}(),function(){a.u=function(e){return"js/"+e+".d16a31e0.js"}}(),function(){a.miniCssF=function(e){}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="frontend:";a.l=function(l,n,r,s){if(e[l])e[l].push(n);else{var u,o;if(void 0!==r)for(var i=document.getElementsByTagName("script"),d=0;d<i.length;d++){var c=i[d];if(c.getAttribute("src")==l||c.getAttribute("data-webpack")==t+r){u=c;break}}u||(o=!0,u=document.createElement("script"),u.charset="utf-8",u.timeout=120,a.nc&&u.setAttribute("nonce",a.nc),u.setAttribute("data-webpack",t+r),u.src=l),e[l]=[n];var v=function(t,a){u.onerror=u.onload=null,clearTimeout(k);var n=e[l];if(delete e[l],u.parentNode&&u.parentNode.removeChild(u),n&&n.forEach(function(e){return e(a)}),t)return t(a)},k=setTimeout(v.bind(null,void 0,{type:"timeout",target:u}),12e4);u.onerror=v.bind(null,u.onerror),u.onload=v.bind(null,u.onload),o&&document.head.appendChild(u)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){var e={524:0};a.f.j=function(t,l){var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)l.push(n[2]);else{var r=new Promise(function(a,l){n=e[t]=[a,l]});l.push(n[2]=r);var s=a.p+a.u(t),u=new Error,o=function(l){if(a.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var r=l&&("load"===l.type?"missing":l.type),s=l&&l.target&&l.target.src;u.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",u.name="ChunkLoadError",u.type=r,u.request=s,n[1](u)}};a.l(s,o,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,l){var n,r,s=l[0],u=l[1],o=l[2],i=0;if(s.some(function(t){return 0!==e[t]})){for(n in u)a.o(u,n)&&(a.m[n]=u[n]);if(o)var d=o(a)}for(t&&t(l);i<s.length;i++)r=s[i],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},l=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[504],function(){return a(6520)});l=a.O(l)})();
//# sourceMappingURL=app.f0b158e7.js.map